"use strict";(self.webpackChunkappcircle_docusaurus=self.webpackChunkappcircle_docusaurus||[]).push([[4601],{21561:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>c,toc:()=>h});var r=s(74848),i=s(28453),a=s(11470),t=s(19365);const o={title:"Runner Virtual Machine Setup",description:"Learn how to set up a self-hosted runner as a macOS VM image",tags:["self-hosted runner","runner","vm","virtual machine","setup"],sidebar_class_name:"hidden"},l="Self-hosted Runner as MacOS VM Image",c={id:"self-hosted-appcircle/self-hosted-runner/runner-vm-setup",title:"Runner Virtual Machine Setup",description:"Learn how to set up a self-hosted runner as a macOS VM image",source:"@site/docs/self-hosted-appcircle/self-hosted-runner/runner-vm-setup.md",sourceDirName:"self-hosted-appcircle/self-hosted-runner",slug:"/self-hosted-appcircle/self-hosted-runner/runner-vm-setup",permalink:"/self-hosted-appcircle/self-hosted-runner/runner-vm-setup",draft:!1,unlisted:!1,editUrl:"https://github.com/appcircleio/appcircle-docusaurus/tree/master/docs/self-hosted-appcircle/self-hosted-runner/runner-vm-setup.md",tags:[{label:"self-hosted runner",permalink:"/tags/self-hosted-runner"},{label:"runner",permalink:"/tags/runner"},{label:"vm",permalink:"/tags/vm"},{label:"virtual machine",permalink:"/tags/virtual-machine"},{label:"setup",permalink:"/tags/setup"}],version:"current",frontMatter:{title:"Runner Virtual Machine Setup",description:"Learn how to set up a self-hosted runner as a macOS VM image",tags:["self-hosted runner","runner","vm","virtual machine","setup"],sidebar_class_name:"hidden"},sidebar:"mySidebar",previous:{title:"Amazon Web Services (AWS)",permalink:"/self-hosted-appcircle/self-hosted-runner/cloud-providers/aws"},next:{title:"Server Configuration",permalink:"/self-hosted-appcircle/configure-server/"}},d={},h=[{value:"Requirements",id:"requirements",level:2},{value:"1. Install Homebrew",id:"1-install-homebrew",level:3},{value:"2. Install Tart",id:"2-install-tart",level:3},{value:"3. Configure Power Settings",id:"3-configure-power-settings",level:3},{value:"4. Configure Power Failure Settings",id:"4-configure-power-failure-settings",level:3},{value:"Download MacOS VM",id:"download-macos-vm",level:2},{value:"Download the macOS VM Image Manually",id:"download-the-macos-vm-image-manually",level:3},{value:"Download Xcode Images Manually",id:"download-xcode-images-manually",level:3},{value:"Download the macOS VM and Xcode Images Automatically",id:"download-the-macos-vm-and-xcode-images-automatically",level:3},{value:"Create Base Images",id:"create-base-images",level:2},{value:"Create Base Runner VMs",id:"create-base-runner-vms",level:3},{value:"Configure Base Runner VMs",id:"configure-base-runner-vms",level:3},{value:"Configure Runner 1",id:"configure-runner-1",level:4},{value:"1. Check the Runner Version",id:"1-check-the-runner-version",level:5},{value:"2. Configure Base Runner&#39;s NTP Settings",id:"2-configure-base-runners-ntp-settings",level:5},{value:"3. Trust The Root Certificates of Your Organization",id:"3-trust-the-root-certificates-of-your-organization",level:5},{value:"4. Configure Runner Service",id:"4-configure-runner-service",level:5},{value:"Configure Runner 2",id:"configure-runner-2",level:4},{value:"Operating MacOS VMs",id:"operating-macos-vms",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Start VM",id:"start-vm",level:3},{value:"Stop VM",id:"stop-vm",level:3},{value:"Update Base Images",id:"update-base-images",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Tart list has runner instance in list but I can not SSH into the runner",id:"tart-list-has-runner-instance-in-list-but-i-can-not-ssh-into-the-runner",level:3},{value:"I can SSH into runner but runner is offline at self-hosted runners list",id:"i-can-ssh-into-runner-but-runner-is-offline-at-self-hosted-runners-list",level:3},{value:"Datetime I see in build logs is not correct",id:"datetime-i-see-in-build-logs-is-not-correct",level:3},{value:"I am facing &quot;SSL cert is not valid yet&quot; error in our builds",id:"i-am-facing-ssl-cert-is-not-valid-yet-error-in-our-builds",level:3},{value:"Runners are offline and I noticed that macOS host has been reboot",id:"runners-are-offline-and-i-noticed-that-macos-host-has-been-reboot",level:3},{value:"Runners are offline but when I SSH into host, it suddenly becomes online",id:"runners-are-offline-but-when-i-ssh-into-host-it-suddenly-becomes-online",level:3},{value:"I want to make some configurations to macOS base image but need desktop UI for them",id:"i-want-to-make-some-configurations-to-macos-base-image-but-need-desktop-ui-for-them",level:3}];function u(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"self-hosted-runner-as-macos-vm-image",children:"Self-hosted Runner as MacOS VM Image"}),"\n",(0,r.jsxs)(n.p,{children:["Self-hosted runner installation is explained at Appcircle ",(0,r.jsx)(n.a,{href:"installation",children:"docs"})," in detail. You can install runner in your self-hosted environment by yourself, following instructions on there."]}),"\n",(0,r.jsx)(n.p,{children:"We're also providing ready-to-use runner VM image that you can download from Appcircle CDN. Especially for enterprise installation, it might be more practical than installing from scratch."}),"\n",(0,r.jsx)(n.p,{children:"Here are some reasons for choosing VM image for self-hosted runner;"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"It's more quick and easy way of deploying runner. Just download VM image and make some minor configurations for your environment."}),"\n",(0,r.jsx)(n.li,{children:"While installing runner, we need several packages from various sources on internet and runner installation requires to be online. Since all iOS and android build pipeline tools are included in VM image, you don't need complex firewall rules while deploying runner."}),"\n",(0,r.jsx)(n.li,{children:"It minimizes effects of strict macOS policies applied to host, especially at enterprise environments. Your runner environment will be same as used in Appcircle cloud."}),"\n",(0,r.jsx)(n.li,{children:"Since we use virtual machine for runner, it provides a clean, isolated instance for every build job. It means, known and more stable runner environment. Your runner won't persist any macOS changes done in build pipeline which can make runner unstable in time."}),"\n",(0,r.jsx)(n.li,{children:"You can install and run only one instance of self-hosted runner on a physical machine. On the other hand, using virtualization infrastructure brings us concurrency. We can run multiple instances of runner on the same host."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsx)(n.p,{children:"In order to use macOS VM, we need to install some dependencies on macOS host."}),"\n",(0,r.jsx)(n.h3,{id:"1-install-homebrew",children:"1. Install Homebrew"}),"\n",(0,r.jsx)(n.p,{children:"Script explains what it will do, follow instructions on there."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"\n'})}),"\n",(0,r.jsx)(n.p,{children:"When installation complete, test:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"brew doctor\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"brew --version\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-install-tart",children:"2. Install Tart"}),"\n",(0,r.jsxs)(n.p,{children:["Tap Appcircle repository and install ",(0,r.jsx)(n.code,{children:"tart"})," (Tart is a registered trademark of Cirrus Labs, Inc.)."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"brew tap appcircleio/cli\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"brew install appcircleio/cli/tart\n"})}),"\n",(0,r.jsx)(n.p,{children:"When installation complete, test:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tart --version\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Run ",(0,r.jsx)(n.code,{children:"tart"})," to touch initial folders."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tart list\n"})}),"\n",(0,r.jsx)(n.p,{children:"Create VMs root folder in tart home."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir $HOME/.tart/vms\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-configure-power-settings",children:"3. Configure Power Settings"}),"\n",(0,r.jsx)(n.p,{children:"Configuring power settings on macOS to prevent the system from entering sleep mode is vital when deploying it as an Appcircle runner."}),"\n",(0,r.jsx)(n.p,{children:"By keeping the system awake, you ensure uninterrupted accessibility to your Appcircle runners, preventing any potential offline cases caused by the system going to sleep."}),"\n",(0,r.jsx)(n.p,{children:"This continuous availability is critical for running builds, as it guarantees that your builds can find runners online."}),"\n",(0,r.jsx)(n.p,{children:"We suggest disabling those power settings to make it behave like a server station."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo pmset -a sleep 0\nsudo pmset -a powernap 0\nsudo pmset -a disksleep 0\nsudo pmset -a displaysleep 0\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-configure-power-failure-settings",children:"4. Configure Power Failure Settings"}),"\n",(0,r.jsx)(n.p,{children:"Power failure settings allow a Mac to restart automatically after a power outage or failure. Activating this on a Mac ensures the host comes back online automatically if power is lost, avoiding downtime."}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"For now, Appcircle runners don't support auto-start when the macOS host restarts."}),(0,r.jsxs)(n.p,{children:["You should connect to host with SSH and ",(0,r.jsx)(n.a,{href:"#start-vm",children:"start the VMs"})," manually."]})]}),"\n",(0,r.jsx)(n.p,{children:"To configure power failure settings, you can run the command below."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo /usr/sbin/systemsetup -setrestartpowerfailure on\n"})}),"\n",(0,r.jsx)(n.p,{children:'You should see "setrestartpowerfailure: On" in the command output after successful execution.'}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"If your host doesn't support this feature, you will get the message below."}),(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Restart After Power Failure: Not supported on this machine."}),"\n"]}),(0,r.jsx)(n.p,{children:"You can ignore power failure settings if they are not supported."})]}),"\n",(0,r.jsx)(n.h2,{id:"download-macos-vm",children:"Download MacOS VM"}),"\n",(0,r.jsx)(n.p,{children:"You have two options to obtain the Appcircle runner images: manual or automated."}),"\n",(0,r.jsxs)(n.p,{children:["To perform these tasks manually, you can follow our step-by-step guide on ",(0,r.jsx)(n.a,{href:"#download-the-macos-vm-image-manually",children:"downloading the macOS VM image manually"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Alternatively, you can automate this process in the background by following our instructions on ",(0,r.jsx)(n.a,{href:"#download-the-macos-vm-and-xcode-images-automatically",children:"downloading the macOS VM and Xcode images automatically"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"download-the-macos-vm-image-manually",children:"Download the macOS VM Image Manually"}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsx)(n.p,{children:"MacOS VM image has a versioning convention based on release date instead of arbitrary numbers. This date-based approach is called calendar versioning, or CalVer for short."}),(0,r.jsxs)(n.p,{children:["Our calendar versioning scheme for the macOS image is ",(0,r.jsx)(n.code,{children:"YY0M0D"}),". For example, a macOS image that's released on March 6, 2024, should have version ",(0,r.jsx)(n.code,{children:"240306"}),"."]}),(0,r.jsx)(n.p,{children:"The versions are listed in chronological order, from the earliest to the most recent, in the tabs below."})]}),"\n",(0,r.jsx)(n.p,{children:"Download macOS VM from Appcircle bucket."}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -L -O -C - https://storage.googleapis.com/appcircle-dev-common/self-hosted/macOS_240306.tar.gz\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -L -O -C - https://storage.googleapis.com/appcircle-dev-common/self-hosted/macOS_240514.tar.gz\n"})})})]}),"\n",(0,r.jsx)(n.p,{children:"If you encounter network interruption, just run the same command again. It should continue download for remaining part. It will result in saving both time and bandwidth."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," You can check the integrity of downloaded file by comparing the MD5 checksum."]}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"md5 macOS_240306.tar.gz\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"md5 macOS_240514.tar.gz\n"})})})]}),"\n",(0,r.jsx)(n.p,{children:"After a couple of minutes later you should see the output below."}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"MD5 (macOS_240306.tar.gz) = 084a9221075ed5453aceba6a3438b134\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"MD5 (macOS_240514.tar.gz) = 8524abc65668a084589e79f214a9b281\n"})})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"Create folder for VM."}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p $HOME/.tart/vms/macOS_240306\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p $HOME/.tart/vms/macOS_240514\n"})})})]}),"\n",(0,r.jsx)(n.p,{children:"Extract archive into VMs folder."}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tar -zxf macOS_240306.tar.gz --directory $HOME/.tart/vms/macOS_240306\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tar -zxf macOS_240514.tar.gz --directory $HOME/.tart/vms/macOS_240514\n"})})})]}),"\n",(0,r.jsx)(n.p,{children:"It may take a little to complete. Be patient and wait return of command."}),"\n",(0,r.jsx)(n.p,{children:"You can track progress of extraction by monitoring VM folder size."}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"du -sh $HOME/.tart/vms/macOS_240306\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"du -sh $HOME/.tart/vms/macOS_240514\n"})})})]}),"\n",(0,r.jsx)(n.h3,{id:"download-xcode-images-manually",children:"Download Xcode Images Manually"}),"\n",(0,r.jsx)(n.p,{children:"Download Xcode images from the Appcircle bucket. They are disk images for each Xcode version archived in a package."}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -L -O -C - https://storage.googleapis.com/appcircle-dev-common/self-hosted/xcodes_240306.tar.gz\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -L -O -C - https://storage.googleapis.com/appcircle-dev-common/self-hosted/xcodes_240514.tar.gz\n"})})})]}),"\n",(0,r.jsx)(n.p,{children:"If you encounter network interruption, just run the same command again. It should continue download for remaining part. It will result in saving both time and bandwidth."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," You can check the integrity of downloaded file by comparing the MD5 checksum."]}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"md5 xcodes_240306.tar.gz\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"md5 xcodes_240514.tar.gz\n"})})})]}),"\n",(0,r.jsx)(n.p,{children:"After a couple of minutes later you should see the output below."}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"MD5 (xcodes_240306.tar.gz) = 4df051e11b6c0b8670cd9b82928dfab2\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"MD5 (xcodes_240514.tar.gz) = e3edc40c9b6dda91530d8a1f8cf456bc\n"})})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"Create folder for the Xcode disk images."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p $HOME/images\n"})}),"\n",(0,r.jsx)(n.p,{children:"Extract archive into the folder."}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tar -zxf xcodes_240306.tar.gz --directory $HOME/images\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tar -zxf xcodes_240514.tar.gz --directory $HOME/images\n"})})})]}),"\n",(0,r.jsx)(n.p,{children:"It may take a little to complete. Be patient and wait return of command."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsxs)(t.A,{value:"240306",label:"240306",children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," This macOS VM image is the Sonoma (",(0,r.jsx)(n.code,{children:"14.1"}),") stack and comes with the Xcode versions below:"]}),(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"15.3.x"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"15.2.x"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"15.1.x"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"15.0.x"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"14.3.x"})}),"\n"]}),"\n"]})]}),(0,r.jsxs)(t.A,{value:"240514",label:"240514",default:!0,children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," This macOS VM image contains the same tools as in the ",(0,r.jsx)(n.code,{children:"latest"}),' "Default M1 Pool" in Appcircle Cloud.']}),(0,r.jsxs)(n.p,{children:["It's the same image that's used for the ",(0,r.jsx)(n.code,{children:"latest"})," Sonoma (",(0,r.jsx)(n.code,{children:"14.1"}),") stack and comes with the Xcode versions below:"]}),(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"15.4.x"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"15.3.x"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"15.2.x"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"15.1.x"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"15.0.x"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"14.3.x"})}),"\n"]}),"\n"]})]})]}),"\n",(0,r.jsx)(n.p,{children:"In order to keep free disk space sufficient for build pipelines, we're packaging the latest and most frequently used Xcode versions. But you can also install other Xcode versions yourself if required."}),"\n",(0,r.jsx)(n.p,{children:"You can find more information about the build infrastructure in the documents below:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/infrastructure/ios-build-infrastructure",children:"iOS Build Infrastructure"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/infrastructure/android-build-infrastructure",children:"Android Build Infrastructure"})}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.p,{children:"We're constantly bumping the VM macOS version according to Xcode requirements."}),(0,r.jsxs)(n.p,{children:["So the latest VM image,",(0,r.jsx)(n.code,{children:"macOS_230921"})," or later, includes Ventura ",(0,r.jsx)(n.code,{children:"13.5.2"})," or Sonoma ",(0,r.jsx)(n.code,{children:"14.1"})," pre-installed and needs at least a Ventura host to run."]}),(0,r.jsx)(n.p,{children:"It doesn't support running on older hosts like Monterey, Big Sur, etc."}),(0,r.jsx)(n.p,{children:"If you don't need the latest Xcode and you want to run an older version of the macOS VM image that supports running on a Monterey host, contact us through our support channels."})]}),"\n",(0,r.jsx)(n.h3,{id:"download-the-macos-vm-and-xcode-images-automatically",children:"Download the macOS VM and Xcode Images Automatically"}),"\n",(0,r.jsx)(n.p,{children:"To download and extract the Appcircle runner VM and Xcode images in the background automatically, you can run the command below."}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -fsSL -O https://cdn.appcircle.io/self-hosted/download-runner.sh && \\\nchmod +x download-runner.sh && \\\nnohup ./download-runner.sh "240306" &\n'})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -fsSL -O https://cdn.appcircle.io/self-hosted/download-runner.sh && \\\nchmod +x download-runner.sh && \\\nnohup ./download-runner.sh "240514" &\n'})})})]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"If you face any errors while downloading the files, please delete the corrupted file and re-run the command block above."})}),"\n",(0,r.jsx)(n.p,{children:"It may take some time to complete with respect to your network speed. You can see and follow the logs with the command below."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tail -f nohup.out\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"You can close the SSH or terminal session while the tool is running. The download and extract process will go on in the background."}),(0,r.jsx)(n.p,{children:"But be aware that there might be some errors while downloading and extracting the VM image, such as network or disk errors. Please keep an eye on the logs."})]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["If no specific image identifier is provided when executing the ",(0,r.jsx)(n.code,{children:"download-runner.sh"})," tool, it will automatically attempt to download the most recent runner images."]})}),"\n",(0,r.jsx)(n.h2,{id:"create-base-images",children:"Create Base Images"}),"\n",(0,r.jsx)(n.h3,{id:"create-base-runner-vms",children:"Create Base Runner VMs"}),"\n",(0,r.jsx)(n.p,{children:"Apple's virtualization framework allows us to run up to two macOS VMs on host."}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsxs)(n.p,{children:["If you have installed the macOS VM image previously and you're currently trying to upgrade your self-hosted runner environment to another release, first ",(0,r.jsx)(n.a,{href:"#stop-vm",children:"stop"})," the runners if they're online."]}),(0,r.jsxs)(n.p,{children:["Since the below steps will create new ",(0,r.jsx)(n.code,{children:"vm01"})," and ",(0,r.jsx)(n.code,{children:"vm02"})," from the base image, you should also cleanup the current ones using ",(0,r.jsx)(n.code,{children:"tart delete"})," command."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tart delete vm01\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tart delete vm02\n"})})]}),"\n",(0,r.jsx)(n.p,{children:"Each runner must register to the self-hosted Appcircle server with a unique name and configuration. So we will need two VM base images."}),"\n",(0,r.jsxs)(n.p,{children:["When you list VMs with ",(0,r.jsx)(n.code,{children:"tart list"})," command, you should see our extracted VM image in list."]}),"\n",(0,r.jsx)(n.p,{children:"In the steps below, we will create 2 base images named vm01 and vm02."}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"vm01"})," base image is derived from our base image, and subsequently, the ",(0,r.jsx)(n.code,{children:"vm02"})," base image will be created from the ",(0,r.jsx)(n.code,{children:"vm01"})," base image."]}),(0,r.jsxs)(n.p,{children:["This approach eliminates the need to redo all the configurations applied to ",(0,r.jsx)(n.code,{children:"vm01"})," when setting up ",(0,r.jsx)(n.code,{children:"vm02"}),", ensuring efficiency and consistency across both virtual machines."]})]}),"\n",(0,r.jsx)(n.p,{children:"Create VM image for runner1."}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tart clone macOS_240306 vm01\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tart clone macOS_240514 vm01\n"})})})]}),"\n",(0,r.jsxs)(n.p,{children:["In docker terminology, ",(0,r.jsx)(n.code,{children:"vm01"})," and ",(0,r.jsx)(n.code,{children:"vm02"})," will be our docker images. We will configure them separately, persist our changes and then create containers to execute build pipelines. On every build, fresh containers will be used for both runners."]}),"\n",(0,r.jsx)(n.h3,{id:"configure-base-runner-vms",children:"Configure Base Runner VMs"}),"\n",(0,r.jsx)(n.h4,{id:"configure-runner-1",children:"Configure Runner 1"}),"\n",(0,r.jsx)(n.p,{children:"Start runner1 VM image for configuration."}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"screen -d -m tart run vm01 --no-graphics \\\n  --disk=$HOME/images/xcode.14.3.dmg:ro \\\n  --disk=$HOME/images/xcode.15.0.dmg:ro \\\n  --disk=$HOME/images/xcode.15.1.dmg:ro \\\n  --disk=$HOME/images/xcode.15.2.dmg:ro \\\n  --disk=$HOME/images/xcode.15.3.dmg:ro\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"screen -d -m tart run vm01 --no-graphics \\\n  --disk=$HOME/images/xcode.14.3.dmg:ro \\\n  --disk=$HOME/images/xcode.15.0.dmg:ro \\\n  --disk=$HOME/images/xcode.15.1.dmg:ro \\\n  --disk=$HOME/images/xcode.15.2.dmg:ro \\\n  --disk=$HOME/images/xcode.15.3.dmg:ro \\\n  --disk=$HOME/images/xcode.15.4.dmg:ro\n"})})})]}),"\n",(0,r.jsx)(n.p,{children:"SSH login into running macOS VM."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -o StrictHostKeyChecking=no appcircle@$(tart ip vm01)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"}),' You should use "cicd" as SSH login password.']}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"While trying to connect VM you can get an SSH connection error as below."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"ssh: Could not resolve hostname err: nodename nor servname provided, or not known\n"})}),(0,r.jsx)(n.p,{children:"Wait a couple of seconds and let the VM start its internal services. You can try the same command until you connect successfully."})]}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"Since the VM IPs are rotating, it's possible to see the below error when you try to connect to the VM in the long term."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nIT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!\nSomeone could be eavesdropping on you right now (man-in-the-middle attack)!\nIt is also possible that a host key has just been changed.\nThe fingerprint for the ED25519 key sent by the remote host is\nSHA256:f6CfksJoc0/ZIqItwH5IJDN87SP6RiOo9q1irzDxawU.\nPlease contact your system administrator.\nAdd correct host key in /Users/appcircle/.ssh/known_hosts to get rid of this message.\nOffending ED25519 key in /Users/appcircle/.ssh/known_hosts:5\nPassword authentication is disabled to avoid man-in-the-middle attacks.\nKeyboard-interactive authentication is disabled to avoid man-in-the-middle attacks.\nUpdateHostkeys is disabled because the host key is not trusted.\nappcircle@192.168.64.2: Permission denied (publickey,password,keyboard-interactive).\n"})}),(0,r.jsxs)(n.p,{children:["The above example error message indicates that there is an entry for the server ",(0,r.jsx)(n.code,{children:"192.168.64.2"})," located on line 5 of the ",(0,r.jsx)(n.code,{children:"known_hosts"})," file that needs to be removed."]}),(0,r.jsx)(n.p,{children:"You can delete the old host key entry with the following command and then try re-connecting."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh-keygen -R $(tart ip vm01)\n"})})]}),"\n",(0,r.jsxs)(n.p,{children:["In the macOS VM, ",(0,r.jsx)(n.code,{children:"/Volumes/agent-disk/appcircle-runner"})," is the root folder of runner."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd /Volumes/agent-disk/appcircle-runner\n"})}),"\n",(0,r.jsxs)(n.p,{children:["So, the following commands will assume that current working directory is ",(0,r.jsx)(n.code,{children:"/Volumes/agent-disk/appcircle-runner"}),"."]}),"\n",(0,r.jsx)(n.h5,{id:"1-check-the-runner-version",children:"1. Check the Runner Version"}),"\n",(0,r.jsx)(n.p,{children:"You may have installed the latest Appcircle runner VM image, but the Appcircle runner may not be up-to-date."}),"\n",(0,r.jsx)(n.p,{children:"You can follow the steps below to check the Appcircle runner version and upgrade if it isn't the latest version."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Check the version of the current installation."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./ac-runner --version\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Check the latest version from the ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/self-hosted-runner/update#1-update-runner",children:"Upgrade Runner"})," page."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["If your version is not up to date, please follow the ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/self-hosted-runner/update#1-update-runner",children:"Update Runner"})," section in the page."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsxs)(n.p,{children:["You should run the ",(0,r.jsx)(n.code,{children:"curl"})," and ",(0,r.jsx)(n.code,{children:"unzip"})," commands on the ",(0,r.jsx)(n.code,{children:"/Volumes/agent-disk/"})," path."]}),(0,r.jsxs)(n.p,{children:["Since you're in the ",(0,r.jsx)(n.code,{children:"appcircle-runner"})," directory now, please change the directory one level up."]})]}),"\n",(0,r.jsxs)(n.p,{children:["You don't need to apply the ",(0,r.jsx)(n.code,{children:"Reconfigure Runner"})," section. But the ",(0,r.jsx)(n.code,{children:"Reinstall Service"})," section is necessary since the latest version may also have some service updates."]}),"\n",(0,r.jsxs)(n.p,{children:["When you complete update successfully, you should see the updated version in ",(0,r.jsx)(n.code,{children:"--version"})," output."]}),"\n",(0,r.jsxs)(n.p,{children:["Go to the ",(0,r.jsx)(n.code,{children:"appcircle-runner"})," directory."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd appcircle-runner\n"})}),"\n",(0,r.jsx)(n.p,{children:"Check the version of the runner."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./ac-runner --version\n"})}),"\n",(0,r.jsx)(n.h5,{id:"2-configure-base-runners-ntp-settings",children:"2. Configure Base Runner's NTP Settings"}),"\n",(0,r.jsx)(n.p,{children:"MacOS VMs try to update their date and time using the network time protocol (NTP) by default."}),"\n",(0,r.jsx)(n.p,{children:"If your organization has limited network access for the Appcircle runner machine, the VM may be unable to reach the servers responsible for updating its date and time settings."}),"\n",(0,r.jsx)(n.p,{children:"In a situation like that, your organization might have an NTP server for internal usage."}),"\n",(0,r.jsx)(n.p,{children:"You can configure your macOS runner VM to use your organization's own NTP server."}),"\n",(0,r.jsxs)(n.p,{children:["You can use the helper script named ",(0,r.jsx)(n.code,{children:"configure_ntp.sh"})," that comes with the runner package to configure the NTP settings."]}),"\n",(0,r.jsx)(n.p,{children:"To configure NTP settings:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The IP address or URL of the NTP server should be known."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Network access should be allowed from the Appcircle runner to the NTP server."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["You will find a script named ",(0,r.jsx)(n.code,{children:"configure_ntp.sh"})," in the ",(0,r.jsx)(n.code,{children:"scripts"})," folder inside the ",(0,r.jsx)(n.code,{children:"appcircle-runner"})," directory."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Run the script and give the NTP server IP (or URL) as an argument, like the example below:"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./scripts/configure_ntp.sh "10.10.1.50"\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsx)(n.p,{children:'You should change "10.10.1.50" to the NTP server address of your organization in the example above.'})}),"\n",(0,r.jsx)(n.h5,{id:"3-trust-the-root-certificates-of-your-organization",children:"3. Trust The Root Certificates of Your Organization"}),"\n",(0,r.jsx)(n.p,{children:"If the resources you want to connect use a self-signed certificate, you should also trust the root certificate of your organization in your Appcircle runner VMs. These resources can be:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Git providers (GitLab, Bitbucket, Azure DevOps, etc.)"}),"\n",(0,r.jsx)(n.li,{children:"Self-hosted Appcircle server"}),"\n",(0,r.jsx)(n.li,{children:"Proxy server for network access"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Trusting your organization's root certificate on the OS is crucial."}),"\n",(0,r.jsx)(n.p,{children:"Because the runner will try to connect to these resources over HTTPS and the SSL certificate will be signed with your organization's root certificate."}),"\n",(0,r.jsx)(n.p,{children:"Furthermore, if the runner attempts to access external web sites, the requests will most likely be intercepted by the proxy and re-signed with a self-issued certificate that is also signed by the root certificate."}),"\n",(0,r.jsxs)(n.p,{children:["You can use the helper script named ",(0,r.jsx)(n.code,{children:"install_cert.sh"}),"\xa0that comes with your runner package to configure the certificates."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["You will find a script named ",(0,r.jsx)(n.code,{children:"install_cert.sh"})," in the ",(0,r.jsx)(n.code,{children:"scripts"})," folder inside the ",(0,r.jsx)(n.code,{children:"appcircle-runner"})," directory."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Run the script like the example below:"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./scripts/install_cert.sh\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The script will ask you to enter a URL. Please give the URL of the resource that you need to connect to from the runner."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:'Hit "enter" and check the results.'}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Your organization's root CA certificate is now trusted on the OS, Java, Ruby, and Node.js."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["For more detailed usage, you can check the ",(0,r.jsx)(n.a,{href:"./configure-runner/custom-certificates#adding-certificates",children:"Self-signed Certificates"})," page."]})}),"\n",(0,r.jsx)(n.h5,{id:"4-configure-runner-service",children:"4. Configure Runner Service"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," Runner logs are kept in ",(0,r.jsx)(n.code,{children:"$HOME/appcircle-runner"})," folder."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"Stop runner service."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./ac-runner service -c stop\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Edit ",(0,r.jsx)(n.code,{children:"appsettings.json"})," with your favorite editor. (nano, vi etc.)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  ...\n  "ASPNETCORE_NOSHUTDOWN": "false",\n  ...\n  "ASPNETCORE_BASE_API_URL": "https://api.test-appcircle.tool.zb/build/v1"\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["ASPNETCORE_NOSHUTDOWN: It should be ",(0,r.jsx)(n.code,{children:"false"}),". So, it will shutdown VM when build complete."]}),"\n",(0,r.jsx)(n.li,{children:"ASPNETCORE_BASE_API_URL: It should be your self-hosted appcircle server URL."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Runner will register to server defined in ",(0,r.jsx)(n.code,{children:"ASPNETCORE_BASE_API_URL"})," and take build jobs from there."]}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.p,{children:["The latest macOS VM image,",(0,r.jsx)(n.code,{children:"macOS_240221"})," or later, has the ASPNETCORE_NOSHUTDOWN setting as ",(0,r.jsx)(n.code,{children:"false"})," by default and has no pre-defined ASPNETCORE_BASE_API_URL setting in the ",(0,r.jsx)(n.code,{children:"appsettings.json"})," file."]}),(0,r.jsxs)(n.p,{children:["So, if you did not upgrade the packaged self-hosted runner at ",(0,r.jsx)(n.a,{href:"#1-check-the-runner-version",children:"previous steps"})," above, only modifying the ASPNETCORE_BASE_API_URL value with the following command should be enough for the self-hosted runner configuration."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'echo "$(jq \'.ASPNETCORE_BASE_API_URL="https://api.test-appcircle.tool.zb/build/v1"\' appsettings.json)" > appsettings.json\n'})}),(0,r.jsx)(n.p,{children:"If you upgraded the self-hosted runner, you must also modify the ASPNETCORE_NOSHUTDOWN setting as well."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'echo "$(jq \'.ASPNETCORE_NOSHUTDOWN="false"\' appsettings.json)" > appsettings.json\n'})})]}),"\n",(0,r.jsxs)(n.p,{children:["Create runner access token from appcircle server and register runner to server. See details in ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/self-hosted-runner/installation#2-register",children:"here"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"For example,"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./ac-runner register -t aat_eev4NQdG_7F2jodmMShBFhh_DgabOJSsWSMojX5_lo4 -n runner1 -p macOS_pool\n"})}),"\n",(0,r.jsxs)(n.p,{children:["It won't print anything to CLI on success. You can also check its exit value with ",(0,r.jsx)(n.code,{children:"echo $?"}),". It should be ",(0,r.jsx)(n.code,{children:"0"})," on success."]}),"\n",(0,r.jsx)(n.p,{children:"Finally run below command to edit self-hosted runner configuration for pre-installed platforms."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'echo "$(jq \'.OsValues = ["ios","android"]\' selfHosted.json)" > selfHosted.json\n'})}),"\n",(0,r.jsx)(n.p,{children:"Start runner service."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./ac-runner service -c start\n"})}),"\n",(0,r.jsx)(n.p,{children:'Now you should see "runner1" in "Build > Self-hosted Runners" list. It may take a couple of seconds to become online.'}),"\n",(0,r.jsx)(n.p,{children:'If "runner1" is online, we can shutdown VM since configuration is done with success.'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo shutdown -h now\n"})}),"\n",(0,r.jsx)(n.h4,{id:"configure-runner-2",children:"Configure Runner 2"}),"\n",(0,r.jsx)(n.p,{children:"As we configured the runner1 (vm01), we can clone vm01 to vm02."}),"\n",(0,r.jsx)(n.p,{children:"So we won't need to reconfigure NTP settings, self-signed SSL certificates, or other configurations that we made for vm01."}),"\n",(0,r.jsx)(n.p,{children:"Create VM image for runner2 from runner1."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tart clone vm01 vm02\n"})}),"\n",(0,r.jsx)(n.p,{children:"Start runner2 image for configuration."}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"screen -d -m tart run vm02 --no-graphics \\\n  --disk=$HOME/images/xcode.14.3.dmg:ro \\\n  --disk=$HOME/images/xcode.15.0.dmg:ro \\\n  --disk=$HOME/images/xcode.15.1.dmg:ro \\\n  --disk=$HOME/images/xcode.15.2.dmg:ro \\\n  --disk=$HOME/images/xcode.15.3.dmg:ro\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"screen -d -m tart run vm02 --no-graphics \\\n  --disk=$HOME/images/xcode.14.3.dmg:ro \\\n  --disk=$HOME/images/xcode.15.0.dmg:ro \\\n  --disk=$HOME/images/xcode.15.1.dmg:ro \\\n  --disk=$HOME/images/xcode.15.2.dmg:ro \\\n  --disk=$HOME/images/xcode.15.3.dmg:ro \\\n  --disk=$HOME/images/xcode.15.4.dmg:ro\n"})})})]}),"\n",(0,r.jsx)(n.p,{children:"SSH login into running macOS VM."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -o StrictHostKeyChecking=no appcircle@$(tart ip vm02)\n"})}),"\n",(0,r.jsx)(n.p,{children:'After login, configuration steps for Appcircle runner service are the same as "runner1". So, we don\'t need to repeat same commands again.'}),"\n",(0,r.jsx)(n.p,{children:'The only difference should be runner naming. It must be unique. For the second runner, just give a different name. For example, "runner2".'}),"\n",(0,r.jsxs)(n.p,{children:["Refer to the ",(0,r.jsx)(n.a,{href:"#4-configure-runner-service",children:"Configure Runner Service"})," for detailed Appcircle runner service configuration."]}),"\n",(0,r.jsxs)(n.p,{children:["After shutdown, we're ready to run instances from ",(0,r.jsx)(n.code,{children:"vm01"})," and ",(0,r.jsx)(n.code,{children:"vm02"})," base VM images."]}),"\n",(0,r.jsxs)(n.p,{children:["At this stage, your VM list returned by ",(0,r.jsx)(n.code,{children:"tart list"})," might be like below, according to your preferred macOS VM image version."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"Source Name         Size\nlocal  macOS_240306 167\nlocal  vm01         130\nlocal  vm02         130\n"})}),"\n",(0,r.jsx)(n.h2,{id:"operating-macos-vms",children:"Operating MacOS VMs"}),"\n",(0,r.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"We need to create two seperate folders for two runners. These will be their working directories on runtime."}),"\n",(0,r.jsx)(n.p,{children:'Create folder for "runner1".'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir $HOME/runner1\n"})}),"\n",(0,r.jsx)(n.p,{children:'Create folder for "runner2".'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir $HOME/runner2\n"})}),"\n",(0,r.jsx)(n.p,{children:"We have a simple bash script that will be used to run VM instances in loop."}),"\n",(0,r.jsx)(n.p,{children:"Download the script into runner folders you created and make script executable."}),"\n",(0,r.jsx)(n.p,{children:'For "runner1" use below commands.'}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -L -o $HOME/runner1/run.sh https://storage.googleapis.com/appcircle-dev-common/self-hosted/run-1.0.3.sh && \\\nchmod u+x $HOME/runner1/run.sh\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -L -o $HOME/runner1/run.sh https://storage.googleapis.com/appcircle-dev-common/self-hosted/run-1.0.4.sh && \\\nchmod u+x $HOME/runner1/run.sh\n"})})})]}),"\n",(0,r.jsx)(n.p,{children:'For "runner2" use below commands.'}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -L -o $HOME/runner2/run.sh https://storage.googleapis.com/appcircle-dev-common/self-hosted/run-1.0.3.sh && \\\nchmod u+x $HOME/runner2/run.sh\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -L -o $HOME/runner2/run.sh https://storage.googleapis.com/appcircle-dev-common/self-hosted/run-1.0.4.sh && \\\nchmod u+x $HOME/runner2/run.sh\n"})})})]}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsxs)(n.p,{children:["With new versions of the macOS VM image, we're also constantly updating the ",(0,r.jsx)(n.code,{children:"run.sh"})," tool for fixes and improvements."]}),(0,r.jsxs)(n.p,{children:["So, there might be a new version of ",(0,r.jsx)(n.code,{children:"run.sh"})," that's compatible with the latest macOS VM image."]}),(0,r.jsxs)(n.p,{children:["The above commands should be executed on every macOS VM image upgrade in order to get the latest ",(0,r.jsx)(n.code,{children:"run.sh"})," version that's compatible with the latest macOS VM image."]})]}),"\n",(0,r.jsx)(n.h3,{id:"start-vm",children:"Start VM"}),"\n",(0,r.jsx)(n.p,{children:'In order to start "runner1", use below command.'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"screen -d -m $HOME/runner1/run.sh vm01\n"})}),"\n",(0,r.jsx)(n.p,{children:'It will start "runner1" in detached mode and will manage VM lifecycle continuously.'}),"\n",(0,r.jsx)(n.p,{children:'In a couple of minutes, you should see "runner1" as online in self-hosted runners list.'}),"\n",(0,r.jsx)(n.p,{children:'We can also start "runner2" with below command.'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"screen -d -m $HOME/runner2/run.sh vm02\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In docker terminology, we're creating container from docker image at this stage. On build complete, runner will be shutdown automatically and ",(0,r.jsx)(n.code,{children:"run.sh"})," will create a fresh one from macOS image. It continuously does the same operation until stopped."]}),"\n",(0,r.jsxs)(n.p,{children:["We can see running instances on macOS host with ",(0,r.jsx)(n.code,{children:"tart list"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"Source Name                                      Size\nlocal  macOS_240306                              167\nlocal  vm01                                      130\nlocal  vm01-4f496549-cfe8-462c-ba55-774f01c03b4f 130\nlocal  vm02                                      130\nlocal  vm02-9f1fc62a-f43c-40f3-98d0-523ed9a67042 130\n"})}),"\n",(0,r.jsx)(n.p,{children:"As you can see in list, we have new VMs with long unique name. Those are actually online VMs that we started."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"vm01"})," and ",(0,r.jsx)(n.code,{children:"vm02"})," are immutable VM images. On the other hand, others are instances created from VM images."]}),"\n",(0,r.jsx)(n.h3,{id:"stop-vm",children:"Stop VM"}),"\n",(0,r.jsx)(n.p,{children:"In order to stop VM, we need to mark runner as stopped and shutdown online runner over SSH."}),"\n",(0,r.jsxs)(n.p,{children:["Touch ",(0,r.jsx)(n.code,{children:".stop"})," file at runner's working directory."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"touch $HOME/runner1/.stop\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Creating ",(0,r.jsx)(n.code,{children:".stop"})," file prevents creating new instance by ",(0,r.jsx)(n.code,{children:"run.sh"})," on shutdown."]}),"\n",(0,r.jsxs)(n.p,{children:["If runner is executing build pipeline, you may prefer waiting completion of the build job. See ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/self-hosted-runner/configure-runner/runner-service#stop",children:"stop"})," section at self-hosted runner docs. When executing build pipeline completes, runner will be shutdown automatically."]}),"\n",(0,r.jsx)(n.p,{children:"On the other hand if you want to stop runner immediately for whatever reason or it's in idle state, you can SSH into runner and run shutdown command."}),"\n",(0,r.jsxs)(n.p,{children:["First you need to have to find out online runner's VM name from ",(0,r.jsx)(n.code,{children:"tart list"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"Source Name                                      Size\nlocal  macOS_240306                              167\nlocal  vm01                                      130\nlocal  vm01-4f496549-cfe8-462c-ba55-774f01c03b4f 130\nlocal  vm02                                      130\nlocal  vm02-9f1fc62a-f43c-40f3-98d0-523ed9a67042 130\n"})}),"\n",(0,r.jsx)(n.p,{children:'In above list, "vm01-4f496549-cfe8-462c-ba55-774f01c03b4f" is the name of runner that we will shutdown.'}),"\n",(0,r.jsx)(n.p,{children:"SSH login into that runner."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -o StrictHostKeyChecking=no appcircle@$(tart ip vm01-4f496549-cfe8-462c-ba55-774f01c03b4f)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"}),' You should use "cicd" as SSH login password.']}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"Execute shutdown command."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo shutdown -h now\n"})}),"\n",(0,r.jsx)(n.p,{children:"Shutdown process may take a couple of seconds."}),"\n",(0,r.jsxs)(n.p,{children:["After shutdown, you won't see anymore instance from ",(0,r.jsx)(n.code,{children:"vm01"})," on ",(0,r.jsx)(n.code,{children:"tart list"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"Source Name                                      Size\nlocal  macOS_240306                              167\nlocal  vm01                                      130\nlocal  vm02                                      130\nlocal  vm02-9f1fc62a-f43c-40f3-98d0-523ed9a67042 130\n"})}),"\n",(0,r.jsx)(n.p,{children:'After a couple of minutes later, "runner1" will also become offline at self-hosted runners list.'}),"\n",(0,r.jsxs)(n.p,{children:['Steps are also similar for "runner2". You need to touch ',(0,r.jsx)(n.code,{children:".stop"})," file in its working directory and after getting its VM name from ",(0,r.jsx)(n.code,{children:"tart list"}),', you can shutdown "runner2" over SSH.']}),"\n",(0,r.jsx)(n.h2,{id:"update-base-images",children:"Update Base Images"}),"\n",(0,r.jsx)(n.p,{children:"On some cases, you may need to update to your macOS base images in order to make your changes permanent."}),"\n",(0,r.jsx)(n.p,{children:"Below are the ones that frequently occur, but not limited to them."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Your team might use a tool frequently in build pipeline, that's not included in Appcircle macOS image. Installing that tool into the image once will save build time. Your build pipeline will be more efficient and optimized."}),"\n",(0,r.jsxs)(n.li,{children:["You may prefer to get iOS and android tool updates by using ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/self-hosted-runner/update",children:"self-hosted runner update"})," method instead of getting fresh macOS VM image. When you get fresh macOS image you may need to make your custom configurations again."]}),"\n",(0,r.jsx)(n.li,{children:"You may need to make persistent proxy configuration for your internal network requirements."}),"\n",(0,r.jsx)(n.li,{children:"You may need to add your corporate's self-signed root CAs to macOS VM image in order to succeed SSL connections."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Steps, that we need to take, are technically similar as in ",(0,r.jsx)(n.a,{href:"#create-base-images",children:"Create Base Images"})," section. So, a conceptual overview of the steps will be sufficient."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Stop all online runners as explained in ",(0,r.jsx)(n.a,{href:"#stop-vm",children:"Stop VM"})," section."]}),"\n",(0,r.jsxs)(n.li,{children:["Run ",(0,r.jsx)(n.code,{children:"vm01"})," base image."]}),"\n"]}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"screen -d -m tart run vm01 --no-graphics \\\n  --disk=$HOME/images/xcode.14.3.dmg:ro \\\n  --disk=$HOME/images/xcode.15.0.dmg:ro \\\n  --disk=$HOME/images/xcode.15.1.dmg:ro \\\n  --disk=$HOME/images/xcode.15.2.dmg:ro \\\n  --disk=$HOME/images/xcode.15.3.dmg:ro\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"screen -d -m tart run vm01 --no-graphics \\\n  --disk=$HOME/images/xcode.14.3.dmg:ro \\\n  --disk=$HOME/images/xcode.15.0.dmg:ro \\\n  --disk=$HOME/images/xcode.15.1.dmg:ro \\\n  --disk=$HOME/images/xcode.15.2.dmg:ro \\\n  --disk=$HOME/images/xcode.15.3.dmg:ro \\\n  --disk=$HOME/images/xcode.15.4.dmg:ro\n"})})})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["SSH into ",(0,r.jsx)(n.code,{children:"vm01"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -o StrictHostKeyChecking=no appcircle@$(tart ip vm01)\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Make your modifications, configurations or updates in macOS."}),"\n",(0,r.jsxs)(n.li,{children:["Shutdown ",(0,r.jsx)(n.code,{children:"vm01"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Run ",(0,r.jsx)(n.code,{children:"vm02"})," base image."]}),"\n"]}),"\n",(0,r.jsxs)(a.A,{groupId:"macos-image",children:[(0,r.jsx)(t.A,{value:"240306",label:"240306",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"screen -d -m tart run vm02 --no-graphics \\\n  --disk=$HOME/images/xcode.14.3.dmg:ro \\\n  --disk=$HOME/images/xcode.15.0.dmg:ro \\\n  --disk=$HOME/images/xcode.15.1.dmg:ro \\\n  --disk=$HOME/images/xcode.15.2.dmg:ro \\\n  --disk=$HOME/images/xcode.15.3.dmg:ro\n"})})}),(0,r.jsx)(t.A,{value:"240514",label:"240514",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"screen -d -m tart run vm02 --no-graphics \\\n  --disk=$HOME/images/xcode.14.3.dmg:ro \\\n  --disk=$HOME/images/xcode.15.0.dmg:ro \\\n  --disk=$HOME/images/xcode.15.1.dmg:ro \\\n  --disk=$HOME/images/xcode.15.2.dmg:ro \\\n  --disk=$HOME/images/xcode.15.3.dmg:ro \\\n  --disk=$HOME/images/xcode.15.4.dmg:ro\n"})})})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["SSH into ",(0,r.jsx)(n.code,{children:"vm02"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -o StrictHostKeyChecking=no appcircle@$(tart ip vm02)\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Make your modifications, configurations or updates in macOS."}),"\n",(0,r.jsxs)(n.li,{children:["Shutdown ",(0,r.jsx)(n.code,{children:"vm02"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Start offline runners as explained in ",(0,r.jsx)(n.a,{href:"#start-vm",children:"Start VM"})," section."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"tart-list-has-runner-instance-in-list-but-i-can-not-ssh-into-the-runner",children:"Tart list has runner instance in list but I can not SSH into the runner"}),"\n",(0,r.jsx)(n.p,{children:"Rarely your runner might hang or might become offline for some reason."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["You can get its IP with ",(0,r.jsx)(n.code,{children:"tart ip"})," but might not connect."]}),"\n",(0,r.jsxs)(n.li,{children:["Although it's in ",(0,r.jsx)(n.code,{children:"tart list"})," you might not get its IP."]}),"\n",(0,r.jsxs)(n.li,{children:["Detached ",(0,r.jsx)(n.code,{children:"screen"})," session might be terminated because of an error."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"You need to check your macOS host for possible system issues. (disk space, network connectivity, OS reboot etc.)"}),"\n",(0,r.jsxs)(n.p,{children:["You can also check runner's working directory for any error that might happen at virtualization. (",(0,r.jsx)(n.code,{children:"stderr.log"}),", ",(0,r.jsx)(n.code,{children:"stdout.log"}),")"]}),"\n",(0,r.jsx)(n.p,{children:"In this case, you can make your runners operational again by following below steps."}),"\n",(0,r.jsx)(n.p,{children:"1- Make sure detached screen session and all its child processes terminated for the runner."}),"\n",(0,r.jsx)(n.p,{children:'For instance, you can find list of PIDs for "runner2" as seen below.'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"% ps aux | grep vm02 | grep -v grep\nappcircle        35640   0.0  0.1 408653856  18320 s002  S+    2:35PM   0:00.68 tart run vm02-3a003bce-a2ee-4ae7-9500-7754e181c314 --no-graphics\nappcircle        35174   0.0  0.0 408628512   2352 s002  S+    2:20PM   0:00.01 bash /Users/appcircle/runner2/run.sh vm02\nroot             35173   0.0  0.0 408515456   6848 s002  Ss+   2:20PM   0:00.01 login -pflq appcircle /Users/appcircle/runner2/run.sh vm02\nappcircle        35172   0.0  0.0 408654848   1264   ??  Ss    2:20PM   0:00.00 SCREEN -d -m /Users/appcircle/runner2/run.sh vm02\n"})}),"\n",(0,r.jsx)(n.p,{children:"2- Make sure there is no active virtualization framework process for the runner."}),"\n",(0,r.jsx)(n.p,{children:"For instance, you can filter like this."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"% ps aux | grep -i virtualmachine | grep -v grep\nappcircle        35641   0.3 31.9 503225216 10699872   ??  Ss    2:35PM  42:07.38 /System/Library/Frameworks/Virtualization.framework/Versions/A/XPCServices/com.apple.Virtualization.VirtualMachine.xpc/Contents/MacOS/com.apple.Virtualization.VirtualMachine\n"})}),"\n",(0,r.jsx)(n.p,{children:"3- Make sure there is no instance for the runner at VM list. If exists, remove it."}),"\n",(0,r.jsx)(n.p,{children:'For instance, we have an instance for "runner2" seen below.'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"% tart list\nSource Name                                      Size\nlocal  macOS_230309                              187\nlocal  vm01                                      140\nlocal  vm02                                      140\nlocal  vm02-3a003bce-a2ee-4ae7-9500-7754e181c314 125\n"})}),"\n",(0,r.jsx)(n.p,{children:'Remove dangling "runner2".'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tart delete vm02-3a003bce-a2ee-4ae7-9500-7754e181c314\n"})}),"\n",(0,r.jsxs)(n.p,{children:["4- Start VM for the runner as usual by following steps at ",(0,r.jsx)(n.a,{href:"#start-vm",children:"start VM"}),"."]}),"\n",(0,r.jsx)(n.p,{children:'For instance, start "runner2" with command below.'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"screen -d -m $HOME/runner2/run.sh vm02\n"})}),"\n",(0,r.jsx)(n.h3,{id:"i-can-ssh-into-runner-but-runner-is-offline-at-self-hosted-runners-list",children:"I can SSH into runner but runner is offline at self-hosted runners list"}),"\n",(0,r.jsx)(n.p,{children:"In this case, you need to focus on self-hosted runner issues inside macOS VM (guest)."}),"\n",(0,r.jsxs)(n.p,{children:["In order to be able to investigate root cause, you should learn the basics of self-hosted runner. Check our ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/self-hosted-runner",children:"online docs"})," details."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You can check your macOS guest for possible system issues. (disk space, network connectivity etc.)"}),"\n",(0,r.jsx)(n.li,{children:"If you have custom proxy settings on macOS guest, check these settings."}),"\n",(0,r.jsx)(n.li,{children:"If you added custom root CAs to macOS guest, verify their validity for SSL connection errors."}),"\n",(0,r.jsxs)(n.li,{children:["You can check runner launchd service and its logs. (",(0,r.jsx)(n.code,{children:"stdout.log"}),", ",(0,r.jsx)(n.code,{children:"stderr.log"}),", ",(0,r.jsx)(n.code,{children:"logs"})," etc.)"]}),"\n",(0,r.jsx)(n.li,{children:"You should check network access from self-hosted runner to server. (firewall, open ports etc.)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"datetime-i-see-in-build-logs-is-not-correct",children:"Datetime I see in build logs is not correct"}),"\n",(0,r.jsx)(n.p,{children:"This case is related with broken datetime synchronization between runner and server."}),"\n",(0,r.jsx)(n.p,{children:"Both server and runner should synchronize their times with relevant NTP services. Timezone difference is not important. Datetime must be correct in their timezones."}),"\n",(0,r.jsx)(n.p,{children:"If runner doesn't have network access to an NTP server on the internet, you can also configure it to use your internal NTP server."}),"\n",(0,r.jsxs)(n.p,{children:["For updating macOS base image see ",(0,r.jsx)(n.a,{href:"#update-base-images",children:"related section"})," above."]}),"\n",(0,r.jsxs)(n.p,{children:["For configuring NTP settings, see ",(0,r.jsx)(n.a,{href:"#2-configure-base-runners-ntp-settings",children:"Configure Base Runner's NTP Settings"})," section above."]}),"\n",(0,r.jsx)(n.h3,{id:"i-am-facing-ssl-cert-is-not-valid-yet-error-in-our-builds",children:'I am facing "SSL cert is not valid yet" error in our builds'}),"\n",(0,r.jsx)(n.p,{children:"This problem is again related to your macOS VM date and time being out of date."}),"\n",(0,r.jsx)(n.p,{children:"To fix that, you should sync the VMs' date and time with your organization's NTP server."}),"\n",(0,r.jsxs)(n.p,{children:["For updating macOS base image see ",(0,r.jsx)(n.a,{href:"#update-base-images",children:"related section"})," above."]}),"\n",(0,r.jsxs)(n.p,{children:["For configuring NTP settings, see ",(0,r.jsx)(n.a,{href:"#2-configure-base-runners-ntp-settings",children:"Configure Base Runner's NTP Settings"})," section above."]}),"\n",(0,r.jsx)(n.h3,{id:"runners-are-offline-and-i-noticed-that-macos-host-has-been-reboot",children:"Runners are offline and I noticed that macOS host has been reboot"}),"\n",(0,r.jsx)(n.p,{children:"If there is no system crash, one reason for an unintentional reboot may be caused by automatic updates."}),"\n",(0,r.jsx)(n.p,{children:"We suggest disabling automatic updates on macOS host, and get them manually when required."}),"\n",(0,r.jsx)(n.p,{children:"Below are the CLI commands to disable all automatic updates on macOS."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticDownload -bool false\nsudo defaults write /Library/Preferences/com.apple.SoftwareUpdate CriticalUpdateInstall -int 0\nsudo defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticCheckEnabled -bool false\nsudo defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticallyInstallMacOSUpdates -int 0\nsudo defaults write /Library/Preferences/com.apple.commerce AutoUpdate -int 0\n"})}),"\n",(0,r.jsx)(n.h3,{id:"runners-are-offline-but-when-i-ssh-into-host-it-suddenly-becomes-online",children:"Runners are offline but when I SSH into host, it suddenly becomes online"}),"\n",(0,r.jsx)(n.p,{children:"When you install a fresh macOS on a mac device, it comes with predefined power settings which makes it energy efficient."}),"\n",(0,r.jsx)(n.p,{children:"So, most probably, your macOS host sleeps when there is no UI interaction, and awakes on SSH login."}),"\n",(0,r.jsx)(n.p,{children:"To do that, please configure your power settings on the host machine."}),"\n",(0,r.jsxs)(n.p,{children:["You can re-check the ",(0,r.jsx)(n.a,{href:"#3-configure-power-settings",children:"Configure Power Settings"})," title for power management on the host."]}),"\n",(0,r.jsx)(n.h3,{id:"i-want-to-make-some-configurations-to-macos-base-image-but-need-desktop-ui-for-them",children:"I want to make some configurations to macOS base image but need desktop UI for them"}),"\n",(0,r.jsx)(n.p,{children:"If you're not comfortable with CLI, you can also make your customizations using macOS desktop."}),"\n",(0,r.jsxs)(n.p,{children:["For this purpose, remove ",(0,r.jsx)(n.code,{children:"--no-graphics"})," argument from ",(0,r.jsx)(n.code,{children:"tart run"})," commands."]}),"\n",(0,r.jsxs)(n.p,{children:["Below step in ",(0,r.jsx)(n.a,{href:"#update-base-images",children:"update base images"})," section,"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["2- Run ",(0,r.jsx)(n.code,{children:"vm01"})," base image. ",(0,r.jsx)(n.code,{children:"screen -d -m tart run vm01 --no-graphics"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"should be like this in this case."}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["2- Run ",(0,r.jsx)(n.code,{children:"vm01"})," base image. ",(0,r.jsx)(n.code,{children:"screen -d -m tart run vm01"})]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},19365:(e,n,s)=>{s.d(n,{A:()=>t});s(96540);var r=s(18215);const i={tabItem:"tabItem_Ymn6"};var a=s(74848);function t(e){let{children:n,hidden:s,className:t}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.A)(i.tabItem,t),hidden:s,children:n})}},11470:(e,n,s)=>{s.d(n,{A:()=>y});var r=s(96540),i=s(18215),a=s(23104),t=s(56347),o=s(205),l=s(57485),c=s(31682),d=s(89466);function h(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:s}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:s,attributes:r,default:i}}=e;return{value:n,label:s,attributes:r,default:i}}))}(s);return function(e){const n=(0,c.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,s])}function m(e){let{value:n,tabValues:s}=e;return s.some((e=>e.value===n))}function p(e){let{queryString:n=!1,groupId:s}=e;const i=(0,t.W6)(),a=function(e){let{queryString:n=!1,groupId:s}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!s)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:n,groupId:s});return[(0,l.aZ)(a),(0,r.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(i.location.search);n.set(a,e),i.replace({...i.location,search:n.toString()})}),[a,i])]}function g(e){const{defaultValue:n,queryString:s=!1,groupId:i}=e,a=u(e),[t,l]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:s}=e;if(0===s.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!m({value:n,tabValues:s}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${s.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=s.find((e=>e.default))??s[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:a}))),[c,h]=p({queryString:s,groupId:i}),[g,x]=function(e){let{groupId:n}=e;const s=function(e){return e?`docusaurus.tab.${e}`:null}(n),[i,a]=(0,d.Dv)(s);return[i,(0,r.useCallback)((e=>{s&&a.set(e)}),[s,a])]}({groupId:i}),j=(()=>{const e=c??g;return m({value:e,tabValues:a})?e:null})();(0,o.A)((()=>{j&&l(j)}),[j]);return{selectedValue:t,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),x(e)}),[h,x,a]),tabValues:a}}var x=s(92303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=s(74848);function b(e){let{className:n,block:s,selectedValue:r,selectValue:t,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),d=e=>{const n=e.currentTarget,s=l.indexOf(n),i=o[s].value;i!==r&&(c(n),t(i))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const s=l.indexOf(e.currentTarget)+1;n=l[s]??l[0];break}case"ArrowLeft":{const s=l.indexOf(e.currentTarget)-1;n=l[s]??l[l.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":s},n),children:o.map((e=>{let{value:n,label:s,attributes:a}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>l.push(e),onKeyDown:h,onClick:d,...a,className:(0,i.A)("tabs__item",j.tabItem,a?.className,{"tabs__item--active":r===n}),children:s??n},n)}))})}function v(e){let{lazy:n,children:s,selectedValue:i}=e;const a=(Array.isArray(s)?s:[s]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===i));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==i})))})}function w(e){const n=g(e);return(0,f.jsxs)("div",{className:(0,i.A)("tabs-container",j.tabList),children:[(0,f.jsx)(b,{...e,...n}),(0,f.jsx)(v,{...e,...n})]})}function y(e){const n=(0,x.A)();return(0,f.jsx)(w,{...e,children:h(e.children)},String(n))}},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>o});var r=s(96540);const i={},a=r.createContext(i);function t(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);