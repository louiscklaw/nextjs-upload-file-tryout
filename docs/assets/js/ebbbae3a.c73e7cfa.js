"use strict";(self.webpackChunkappcircle_docusaurus=self.webpackChunkappcircle_docusaurus||[]).push([[22892],{51198:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>t,metadata:()=>l,toc:()=>d});var r=s(74848),i=s(28453),o=s(69678);const t={title:"Podman",description:"Learn how to install and configure self-hosted Appcircle server with Podman",tags:["self-hosted","podman","installation","configuration"],sidebar_position:4},a="Overview",l={id:"self-hosted-appcircle/install-server/podman",title:"Podman",description:"Learn how to install and configure self-hosted Appcircle server with Podman",source:"@site/docs/self-hosted-appcircle/install-server/podman.md",sourceDirName:"self-hosted-appcircle/install-server",slug:"/self-hosted-appcircle/install-server/podman",permalink:"/nextjs-upload-file-tryout/self-hosted-appcircle/install-server/podman",draft:!1,unlisted:!1,editUrl:"https://github.com/appcircleio/appcircle-docusaurus/tree/master/docs/self-hosted-appcircle/install-server/podman.md",tags:[{label:"self-hosted",permalink:"/nextjs-upload-file-tryout/tags/self-hosted"},{label:"podman",permalink:"/nextjs-upload-file-tryout/tags/podman"},{label:"installation",permalink:"/nextjs-upload-file-tryout/tags/installation"},{label:"configuration",permalink:"/nextjs-upload-file-tryout/tags/configuration"}],version:"current",sidebarPosition:4,frontMatter:{title:"Podman",description:"Learn how to install and configure self-hosted Appcircle server with Podman",tags:["self-hosted","podman","installation","configuration"],sidebar_position:4},sidebar:"mySidebar",previous:{title:"Docker",permalink:"/nextjs-upload-file-tryout/self-hosted-appcircle/install-server/docker"},next:{title:"Cloud Providers",permalink:"/nextjs-upload-file-tryout/self-hosted-appcircle/install-server/cloud-providers/"}},c={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Supported Linux Distributions",id:"supported-linux-distributions",level:3},{value:"Hardware Requirements",id:"hardware-requirements",level:3},{value:"Swap",id:"swap",level:4},{value:"Swappiness",id:"swappiness",level:4},{value:"Podman Requirements",id:"podman-requirements",level:3},{value:"Enabling the Linger Option",id:"enabling-the-linger-option",level:4},{value:"Overcoming Privileged Port Limitations",id:"overcoming-privileged-port-limitations",level:4},{value:"Firewalld Requirements",id:"firewalld-requirements",level:3},{value:"Installation",id:"installation",level:2},{value:"1. Download",id:"1-download",level:3},{value:"2. Packages",id:"2-packages",level:3},{value:"Podman Network Stack",id:"podman-network-stack",level:4},{value:"Change the Podman Data Location",id:"change-the-podman-data-location",level:4},{value:"3. Configure",id:"3-configure",level:3},{value:"Initial Password",id:"initial-password",level:4},{value:"Troubleshooting",id:"troubleshooting",level:4},{value:"4. DNS Settings",id:"4-dns-settings",level:3},{value:"Using <code>hosts</code> file for DNS Settings",id:"using-hosts-file-for-dns-settings",level:4},{value:"5. Run Server",id:"5-run-server",level:3},{value:"Artifact Registry Credentials: Cred.json",id:"artifact-registry-credentials-credjson",level:4},{value:"Vault",id:"vault",level:4},{value:"Rebooting the Server",id:"rebooting-the-server",level:5},{value:"Using 3rd Party or Self-hosted Artifact Registry",id:"using-3rd-party-or-self-hosted-artifact-registry",level:4},{value:"\ud83c\udf89 Ready",id:"tada-ready",level:3},{value:"Reset Configuration",id:"reset-configuration",level:2},{value:"Connecting Runners",id:"connecting-runners",level:2}];function h(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Following sections give you detailed information about system requirements, installation and configuration steps. After following directives successfully, you will get a running Appcircle instance on your infrastructure."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"Below are the hardware and OS requirements for self-hosted Appcircle installation."}),"\n",(0,r.jsx)(n.h3,{id:"supported-linux-distributions",children:"Supported Linux Distributions"}),"\n",(0,r.jsx)(n.p,{children:"Self-hosted Appcircle server utilizing Podman, can only be installed on Linux operating system."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CentOS Stream 8 or later"}),"\n",(0,r.jsx)(n.li,{children:"RHEL 8 or later"}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"We are working on Ubuntu and Debian support. It will be available soon."})}),"\n",(0,r.jsx)(n.h3,{id:"hardware-requirements",children:"Hardware Requirements"}),"\n",(0,r.jsx)(n.p,{children:"Minimum hardware requirements for self-hosted Appcircle can be:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"100GB or more free disk space"}),"\n",(0,r.jsx)(n.li,{children:"4 or more cores CPU"}),"\n",(0,r.jsx)(n.li,{children:"8 or more gigabytes (GB) RAM"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u261d"," These hardware specs are minimum requirements for basic execution and it can be used only for quick evaluation or development purposes."]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["CPU architecture must be AMD or Intel 64-bit arch (",(0,r.jsx)(n.code,{children:"x86_64"}),")."]})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"If you have enough RAM and a recent CPU, performance of Appcircle server can be limited by hard drive seek times. So, having a fast drive like a solid state drive (SSD) improves runtime."})}),"\n",(0,r.jsx)(n.p,{children:"Higher numbers will be better especially for increased number of users."}),"\n",(0,r.jsxs)(n.p,{children:["For an enterprise installation, ",(0,r.jsx)(n.strong,{children:"minimum"})," hardware requirements are"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"500GB SSD"}),"\n",(0,r.jsx)(n.li,{children:"8 CPU"}),"\n",(0,r.jsx)(n.li,{children:"16GB RAM"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For production environments, ",(0,r.jsx)(n.strong,{children:"recommended"})," hardware requirements are"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"1TB SSD"}),"\n",(0,r.jsx)(n.li,{children:"32 CPU"}),"\n",(0,r.jsx)(n.li,{children:"64GB RAM"}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.h4,{id:"swap",children:"Swap"}),(0,r.jsxs)(n.p,{children:["Using ",(0,r.jsx)(n.strong,{children:"swap"})," file lets self-hosted Appcircle server exceed the size of available physical memory. On memory pressure system will go on its operations with minimal degradation, when SSD used as hardware."]}),(0,r.jsxs)(n.p,{children:["So, we are recommending ",(0,r.jsx)(n.strong,{children:"swap"})," file usage on Linux."]}),(0,r.jsx)(n.p,{children:"Its size should be minimum half of the RAM size. For example if you have 64 GB RAM, then you should choose minimum 32 GB swap file size. 64 GB will be better."}),(0,r.jsx)(n.h4,{id:"swappiness",children:"Swappiness"}),(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"swappiness"})," parameter configures how often your system swaps data out of RAM to the swap space. So, it's an important setting for swap usage and affects performance."]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"10"})," is recommended value for ",(0,r.jsx)(n.code,{children:"swappiness"}),"."]}),(0,r.jsxs)(n.p,{children:["\ud83d\udcda"," For details on how to configure ",(0,r.jsx)(n.strong,{children:"swap"})," and ",(0,r.jsx)(n.code,{children:"swappiness"})," parameter, follow guide in ",(0,r.jsx)(n.a,{href:"https://www.digitalocean.com/community/tutorials/how-to-add-swap-space-on-ubuntu-22-04",children:"here"}),"."]})]}),"\n",(0,r.jsx)(n.h3,{id:"podman-requirements",children:"Podman Requirements"}),"\n",(0,r.jsx)(n.p,{children:"The Appcircle server supports Podman as the container runtime. The minimum required version of Podman is 4.3.0 or higher."}),"\n",(0,r.jsx)(n.h4,{id:"enabling-the-linger-option",children:"Enabling the Linger Option"}),"\n",(0,r.jsxs)(n.p,{children:["To ensure uninterrupted operation of the Appcircle server's background processes, you must enable the ",(0,r.jsx)(n.strong,{children:"linger"})," option on the host system."]}),"\n",(0,r.jsx)(n.p,{children:"Enabling this option allows the podman containers to persist even after user logouts, ensuring continuous functionality."}),"\n",(0,r.jsxs)(n.p,{children:["Check if the ",(0,r.jsx)(n.strong,{children:"linger"})," option is enabled for the current user with the below command."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'loginctl show-user "$USER" --property=Linger\n'})}),"\n",(0,r.jsxs)(n.p,{children:["If you see ",(0,r.jsx)(n.code,{children:"Linger=yes"}),", it means that the option is enabled and you do not need extra configuration."]}),"\n",(0,r.jsxs)(n.p,{children:["If the output is ",(0,r.jsx)(n.code,{children:"Linger=no"}),", this means that the option is disabled and you cannot run the Appcircle server in the background."]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["If the ",(0,r.jsx)(n.strong,{children:"linger"})," option is set to ",(0,r.jsx)(n.code,{children:"no"}),", you must enable it to run the Appcircle server in the background."]})}),"\n",(0,r.jsx)(n.p,{children:"To enable the linger\xa0option, you can use the command below:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"loginctl enable-linger\n"})}),"\n",(0,r.jsx)(n.p,{children:"You can run the Appcircle server in the background now."}),"\n",(0,r.jsx)(n.h4,{id:"overcoming-privileged-port-limitations",children:"Overcoming Privileged Port Limitations"}),"\n",(0,r.jsx)(n.p,{children:"When using Podman rootless to install the Appcircle server, please note that privileged ports (ports below 1024) cannot be utilized in rootless mode. By default, the Appcircle server listens on ports 8080 and 8443."}),"\n",(0,r.jsx)(n.p,{children:"If you want to use ports 80 and 443 without running Podman as root, you need to take some extra steps."}),"\n",(0,r.jsx)(n.p,{children:"Best option is to use a port forwarding tool like socat. This way you can forward traffic from port 80 to 8080 and port 443 to 8443. You should install the socat from official repositories and create two systemd service so port forwarding keeps even after server reboot. This can be done by running the following steps:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo dnf install -y socat\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Save the file below as ",(0,r.jsx)(n.code,{children:"port-redirect-80.service"})," in ",(0,r.jsx)(n.code,{children:"/etc/systemd/system/"})," directory."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"[Unit]\nDescription=Port Redirect Service - Port 80\nAfter=network.target\n\n[Service]\nExecStart=/usr/bin/socat TCP-LISTEN:80,fork,reuseaddr TCP:127.0.0.1:8080\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Save the file below as ",(0,r.jsx)(n.code,{children:"port-redirect-443.service"})," in ",(0,r.jsx)(n.code,{children:"/etc/systemd/system/"})," directory."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"[Unit]\nDescription=Port Redirect Service - Port 443\nAfter=network.target\n\n[Service]\nExecStart=/usr/bin/socat TCP-LISTEN:443,fork,reuseaddr TCP:127.0.0.1:8443\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then, one by one, execute the below commands to activate port redirections."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\nsudo systemctl enable port-redirect-80.service\nsudo systemctl start port-redirect-80.service\nsudo systemctl enable port-redirect-443.service\nsudo systemctl start port-redirect-443.service\n"})}),"\n",(0,r.jsx)(n.h3,{id:"firewalld-requirements",children:"Firewalld Requirements"}),"\n",(0,r.jsx)(n.p,{children:"If you are using firewalld, you need to open the 80 and 443 ports for the Appcircle server."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo firewall-cmd --add-port=80/tcp --permanent\nsudo firewall-cmd --add-port=443/tcp --permanent\nsudo firewall-cmd --reload\n"})}),"\n",(0,r.jsx)(n.p,{children:"To check if the ports are open, you can run the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo firewall-cmd --list-ports\n"})}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.h3,{id:"1-download",children:"1. Download"}),"\n",(0,r.jsx)(n.p,{children:"You need to have the following tools installed on your system:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"curl"}),"\n",(0,r.jsx)(n.li,{children:"unzip"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["To download the licensed Appcircle Server package for your organization, you must copy the ",(0,r.jsx)(n.code,{children:"cred.json"})," file to the directory where you want to install the package."]}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:["Without the ",(0,r.jsx)(n.code,{children:"cred.json"})," file, you will not be able to access the licensed Appcircle Server package."]}),(0,r.jsxs)(n.p,{children:["If you have not yet obtained the ",(0,r.jsx)(n.code,{children:"cred.json"})," file, please contact us for assistance."]})]}),"\n",(0,r.jsx)(n.p,{children:"Download the latest self-hosted Appcircle package."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -fsSL https://cdn.appcircle.io/self-hosted/download-server.sh | bash\n"})}),"\n",(0,r.jsx)(n.p,{children:"Extract self-hosted Appcircle package into folder."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"unzip -o -u appcircle-server-linux-x64-${version}-${build}.zip -d appcircle-server\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["You should use the downloaded ",(0,r.jsx)(n.code,{children:"zip"})," archive while extracting so that the actual ",(0,r.jsx)(n.code,{children:"${version}"})," and ",(0,r.jsx)(n.code,{children:"${build}"})," will come from there. You can find the relevant data in the previously executed download command output."]})}),"\n",(0,r.jsxs)(n.p,{children:["Change directory into extracted ",(0,r.jsx)(n.code,{children:"appcircle-server"})," folder for following steps."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd appcircle-server\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-packages",children:"2. Packages"}),"\n",(0,r.jsx)(n.p,{children:"You need to have the following tool(s) installed on your system."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"podman"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The good news is that the ac-self-hosted.sh script installs all the necessary tools if they are not already installed on your system."}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["You need to have root access on your system for this step. Being able to run ",(0,r.jsx)(n.code,{children:"sudo"})," is sufficient for the following step. (sudoer)"]})}),"\n",(0,r.jsxs)(n.p,{children:["To do this, execute the script using the ",(0,r.jsx)(n.code,{children:"-i"})," argument as shown below."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo ./ac-self-hosted.sh -i\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can also use the long option ",(0,r.jsx)(n.code,{children:"--install-package"})," for the same purpose."]}),"\n",(0,r.jsx)(n.p,{children:"Make sure the script was executed without any error. Script will print installed and required packages when executed. Some packages may need manual installation on some linux distributions. Check command output for warnings and follow directives given in the output."}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"Podman is one of our major dependencies. So, its version is also important for Appcircle server runtime."}),(0,r.jsxs)(n.p,{children:["Older podman versions may be incompatible for our operations. Podman versions above ",(0,r.jsx)(n.code,{children:"4.3.0"})," should be preferred to eliminate any compatibility issues."]})]}),"\n",(0,r.jsx)(n.h4,{id:"podman-network-stack",children:"Podman Network Stack"}),"\n",(0,r.jsx)(n.p,{children:"To ensure successful operation of the Appcircle server, it is required to switch from the CNI network stack to Netavark if Podman is bundled with CNI. You can see your network stack by running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"podman info | grep -i networkBackend\n"})}),"\n",(0,r.jsx)(n.p,{children:"You can switch to Netavark network stack by simply installing Netavark and configure podman to use Netavark."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo dnf install -y netavark\n"})}),"\n",(0,r.jsx)(n.p,{children:"Once the installation is complete, please follow these steps to configure Podman:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Copy the /usr/share/containers/containers.conf file to /etc/containers/containers.conf."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo cp /usr/share/containers/containers.conf /etc/containers/containers.conf\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Edit the /etc/containers/containers.conf file."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo vi /etc/containers/containers.conf\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Add the following content to the [network] section:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'network_backend="netavark"\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Save the file."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Reset Podman:"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"podman system reset\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Reboot the system:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo reboot\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsx)(n.p,{children:"If you skip the step about podman network stack above, you will encounter network related issues. Please make sure you have completed this step."})}),"\n",(0,r.jsx)(n.h4,{id:"change-the-podman-data-location",children:"Change the Podman Data Location"}),"\n",(0,r.jsxs)(n.p,{children:["In certain scenarios, you may encounter situations where the available free space on the root directory (",(0,r.jsx)(n.code,{children:"/"}),") is limited. However, you might have ample free space in a different directory, such as ",(0,r.jsx)(n.code,{children:"$HOME"})," or ",(0,r.jsx)(n.code,{children:"/opt"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"In such cases, you can modify the Podman data location path to utilize the available space in the desired directory."}),"\n",(0,r.jsx)(n.p,{children:"These are the steps to change podman data location path:"}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.p,{children:"If you have selinux enabled, you should disable it temporarily before changing podman data location."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo setenforce 0\n"})})]}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.p,{children:"Podman data path may vary according to users."}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If you will use podman with the root user, the data path is ",(0,r.jsx)(n.code,{children:"/var/lib/containers"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["If you will use podman with regular user, the data path is ",(0,r.jsx)(n.code,{children:"$HOME/.local/share/containers"}),"."]}),"\n"]}),(0,r.jsx)(n.p,{children:"Please be sure about your podman data path."}),(0,r.jsx)(n.p,{children:"The commands below are shown for the root user. Please change it according to your data path."})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stop the podman service."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl stop podman\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Move the existing Podman data directory to the new location."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo mv /var/lib/containers $HOME/podman\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Create a softlink from default location to the new location."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo ln -s $HOME/podman /var/lib/containers\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Restart the podman service."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl start podman\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.p,{children:"If you disabled selinux and want to enable it again, you can run the following command."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo setenforce 1\n"})})]}),"\n",(0,r.jsx)(n.h3,{id:"3-configure",children:"3. Configure"}),"\n",(0,r.jsx)(n.p,{children:"First we need to find a name to our self-hosted Appcircle installation. It will be the unique project name."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "${YOUR_PROJECT}" export\n'})}),"\n",(0,r.jsx)(n.p,{children:'Let\'s assume we have company named as Space Tech. Then our project name can be "spacetech". For following steps, we will give examples based on this fictive company for better understanding.'}),"\n",(0,r.jsx)(n.p,{children:"Then our command to execute will be:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" export\n'})}),"\n",(0,r.jsxs)(n.p,{children:["On ",(0,r.jsx)(n.code,{children:"ac-self-hosted.sh"})," execution complete, the folder contains ",(0,r.jsx)(n.code,{children:"global.yaml"}),", ",(0,r.jsx)(n.code,{children:"user-secret"})," files and ",(0,r.jsx)(n.code,{children:"export"})," folder."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"projects\n\u2514\u2500\u2500 spacetech\n    \u251c\u2500\u2500 export\n    \u251c\u2500\u2500 generated-secret.yaml\n    \u251c\u2500\u2500 global.yaml\n    \u2514\u2500\u2500 user-secret\n"})}),"\n",(0,r.jsxs)(n.p,{children:["At this point, the ",(0,r.jsx)(n.code,{children:"compose.yaml"})," file is generated in\xa0",(0,r.jsx)(n.code,{children:"projects/${YOUR_PROJECT}/export"})," path. But some custom environment variables are not configured for your environment. So we need to configure them."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"global.yaml"})," and ",(0,r.jsx)(n.code,{children:"user-secret"})," files are standard yaml files to configure custom variables for your environment."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"global.yaml"})," file is in human-readable form but ",(0,r.jsx)(n.code,{children:"user-secret"})," is in base64 encoded form."]}),"\n",(0,r.jsxs)(n.p,{children:["You can keep all your environment variables in ",(0,r.jsx)(n.code,{children:"global.yaml"})," but if you don't want to keep some secrets visible in ",(0,r.jsx)(n.code,{children:"global.yaml"}),", you should keep them in ",(0,r.jsx)(n.code,{children:"user-secret"}),"."]}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"user-secret"})," is a complementary file for ",(0,r.jsx)(n.code,{children:"global.yaml"}),". Although it's usage is optional, it's used actively when it has defined values."]}),(0,r.jsxs)(n.p,{children:["So, keep in mind that values kept in ",(0,r.jsx)(n.code,{children:"user-secret"})," always overrides same values in ",(0,r.jsx)(n.code,{children:"global.yaml"}),"."]}),(0,r.jsxs)(n.p,{children:["If you want a secret used from ",(0,r.jsx)(n.code,{children:"global.yaml"}),", then it should not be in ",(0,r.jsx)(n.code,{children:"user-secret"}),". You should remove its definition from ",(0,r.jsx)(n.code,{children:"user-secret"}),"."]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"global.yaml"})," has some initial and example values preset when it's generated."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'---\nenvironment: Production\nenableErrorHandling: "true"\nexternal:\n  scheme: http\n  mainDomain: ".example.com"\n\nsmtpServer:\n  user:\n  from:\n  host:\n  fromDisplayName:\n  port:\n  ssl:\n  auth:\n  starttls:\nkeycloak:\n  initialUsername: admin@example.com\n  enabledRegistration: true\nstoreWeb:\n  external:\n    subdomain: store\n  customDomain:\n    enabled: true\n    domain: store.example.com\n'})}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsxs)(n.p,{children:["In later steps, other system subdomains will be concatted to main domain. For this reason, ",(0,r.jsx)(n.code,{children:"external.mainDomain"})," in configuration file must always begin with ",(0,r.jsx)(n.code,{children:"."})," character as prefix."]}),(0,r.jsxs)(n.p,{children:["You can see a list of these subdomains in ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/install-server/podman#4-dns-settings",children:"here"}),"."]})]}),"\n",(0,r.jsx)(n.p,{children:"As an example, we can change some variables like below according to our fictive company setup."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'---\nenvironment: Production\nenableErrorHandling: "true"\nexternal:\n  scheme: http\n  mainDomain: ".appcircle.spacetech.com"\n\nsmtpServer:\n  user: o***y*****@v******.net\n  from: o***y*****@v******.net\n  host: smtp.v******.net\n  fromDisplayName: Space Tech\n  port: "587"\n  ssl: "false"\n  auth: "true"\n  starttls: "true"\nkeycloak:\n  initialUsername: admin@spacetech.com\n  enabledRegistration: true\nstoreWeb:\n  external:\n    subdomain: store\n  customDomain:\n    enabled: true\n    domain: store.spacetech.com\n'})}),"\n",(0,r.jsx)(n.p,{children:"For our example, we configured below values:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"external.scheme"})," is configured as ",(0,r.jsx)(n.code,{children:"http"})," for our case. When we set as ",(0,r.jsx)(n.code,{children:"https"})," we also need to configure other SSL options. See related section in online docs for SSL configuration details."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"external.mainDomain"})," is set as a subdomain of our example company's main domain. See ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/install-server/podman#4-dns-settings",children:"DNS Settings"})," for more details."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"smtpServer"})," settings are set for e-mail notifications. We choose not to set SMTP password as plain text in here. We will put it to ",(0,r.jsx)(n.code,{children:"user-secret"})," on next steps. But if it's acceptable for you, then you can set ",(0,r.jsx)(n.code,{children:"smtpServer.password"})," variable in here."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"keycloak.initialUsername"})," will be appcircle's default organization's admin user. Its username is set to ",(0,r.jsx)(n.code,{children:"initialUsername"}),". We choose not to set its password as plain text in here. We will put it to ",(0,r.jsx)(n.code,{children:"user-secret"})," on next steps. But if it's acceptable for you, then you can set ",(0,r.jsx)(n.code,{children:"keycloak.initialPassword"})," variable in here."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"storeWeb.customDomain.domain"})," is set with our example company's store domain. It's used for enterprise app store URL."]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.h4,{id:"initial-password",children:"Initial Password"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"keycloak.initialPassword"})," value can not be empty since default organization's admin user will login with that password."]}),(0,r.jsx)(n.p,{children:"Same as in cloud, it must be compatible with Appcircle password policy;"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["minimum character ",(0,r.jsx)(n.strong,{children:"length must be at least 6"})]}),"\n",(0,r.jsxs)(n.li,{children:["must contain at least ",(0,r.jsx)(n.strong,{children:"one lower"})," case character"]}),"\n",(0,r.jsxs)(n.li,{children:["must contain at least ",(0,r.jsx)(n.strong,{children:"one upper"})," case character"]}),"\n",(0,r.jsxs)(n.li,{children:["must contain at least ",(0,r.jsx)(n.strong,{children:"one numerical"})," digit"]}),"\n"]}),(0,r.jsx)(n.h4,{id:"troubleshooting",children:"Troubleshooting"}),(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"keycloak.initialPassword"})," value is not compatible with password policy, you will get below error on service start while ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/install-server/podman#5-run-server",children:"running Appcircle server"}),"."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:'service "keycloak_migration" didn\'t completed successfully: exit 1\n'})}),(0,r.jsxs)(n.p,{children:["In this case, before updating initial password in ",(0,r.jsx)(n.code,{children:"global.yaml"}),", you need to ",(0,r.jsx)(n.strong,{children:"stop"})," partially started podman services with below command. See ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/install-server/podman#reset-configuration",children:"reset configuration"})," section for more details."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" reset\n'})}),(0,r.jsx)(n.p,{children:"After updating initial password, to activate changes, you need to do fresh export."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" export\n'})}),(0,r.jsx)(n.p,{children:"Now you can run services again. It should complete without any error."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" up\n'})})]}),"\n",(0,r.jsxs)(n.p,{children:["As seen in above items, we choose to set some secrets in ",(0,r.jsx)(n.code,{children:"user-secret"})," file. So we need to take additional steps to complete configuration. If you set them as plain text in ",(0,r.jsx)(n.code,{children:"global.yaml"})," then you don't need to take ",(0,r.jsx)(n.code,{children:"user-secret"})," steps."]}),"\n",(0,r.jsx)(n.p,{children:"First create your secret yaml configuration as plain text like below."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"smtpServer:\n  password: 4NZ**********\nkeycloak:\n  initialPassword: ZP6***********\n"})}),"\n",(0,r.jsxs)(n.p,{children:["For example, let's assume our secret yaml file is located in ",(0,r.jsx)(n.code,{children:"projects/spacetech/secret.yaml"})," path."]}),"\n",(0,r.jsxs)(n.p,{children:["In order to convert it to base64 encoded ",(0,r.jsx)(n.code,{children:"user-secret"})," run following command."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"base64 projects/spacetech/secret.yaml > projects/spacetech/user-secret\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can check ",(0,r.jsx)(n.code,{children:"user-secret"})," file content in human-readable form with below command if required."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"base64 -d projects/spacetech/user-secret\n"})}),"\n",(0,r.jsxs)(n.p,{children:["We have ",(0,r.jsx)(n.code,{children:"user-secret"})," filled in successfully and don't need ",(0,r.jsx)(n.code,{children:"projects/spacetech/secret.yaml"})," anymore. So we should delete it."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"rm projects/spacetech/secret.yaml\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsxs)(n.p,{children:["On your first export, which makes ",(0,r.jsx)(n.code,{children:"global.yaml"})," template for you, also creates an empty template file for ",(0,r.jsx)(n.code,{children:"user-secret"})," as seen below:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"base64 -d projects/spacetech/user-secret\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"smtpServer:\n  password:\nkeycloak:\n  initialPassword:\n"})}),(0,r.jsxs)(n.p,{children:["If you prefer defining above variables in ",(0,r.jsx)(n.code,{children:"global.yaml"}),", then they should not be in ",(0,r.jsx)(n.code,{children:"user-secret"}),"."]}),(0,r.jsxs)(n.p,{children:["If you defined all of them in ",(0,r.jsx)(n.code,{children:"global.yaml"}),",simply remove ",(0,r.jsx)(n.code,{children:"user-secret"})," before next steps."]})]}),"\n",(0,r.jsx)(n.p,{children:"Note that after changes made to yaml files, you must execute the script again for the changes to take effect as shown below."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" export\n'})}),"\n",(0,r.jsx)(n.h3,{id:"4-dns-settings",children:"4. DNS Settings"}),"\n",(0,r.jsx)(n.p,{children:"Appcircle server has some subdomains for different services. So, you need to add them to DNS in your network before running server."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"api"}),"\n",(0,r.jsx)(n.li,{children:"auth"}),"\n",(0,r.jsx)(n.li,{children:"dist"}),"\n",(0,r.jsx)(n.li,{children:"hook"}),"\n",(0,r.jsx)(n.li,{children:"my"}),"\n",(0,r.jsx)(n.li,{children:"resource"}),"\n",(0,r.jsx)(n.li,{children:"store"}),"\n",(0,r.jsx)(n.li,{children:"monitor"}),"\n",(0,r.jsx)(n.li,{children:"(optional) Enterprise App Store's Custom Domain"}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["If your configuration (",(0,r.jsx)(n.code,{children:"global.yaml"}),") has setting ",(0,r.jsx)(n.code,{children:"storeWeb.customDomain.enabled:true"}),", it means that you will use a custom domain for Enterprise App Store. So, its value (",(0,r.jsx)(n.code,{children:"storeWeb.customDomain.domain"}),") must be configured on DNS along with other system subdomains."]})}),"\n",(0,r.jsx)(n.p,{children:"Below is an example DNS configuration that is compatible with our sample scenario."}),"\n",(0,r.jsx)(o.A,{url:"https://cdn.appcircle.io/docs/assets/be-2111-10-cloudflare-ss.png"}),"\n",(0,r.jsx)(n.p,{children:"If you have a dedicated DNS, adding subdomains will be enough to run self-hosted Appcircle server in an easy and quick way."}),"\n",(0,r.jsx)(n.p,{children:"You can also make DNS settings later, when you complete all configuration and testing."}),"\n",(0,r.jsxs)(n.p,{children:["Until you're satisfied with your setup, you can use ",(0,r.jsx)(n.code,{children:"/etc/hosts"})," file for both self-hosted Appcircle server and connected clients. You can run whole system, test all functionality and your configuration with using the ",(0,r.jsx)(n.code,{children:"/etc/hosts"})," file."]}),"\n",(0,r.jsx)(n.p,{children:"Following section will give you the details for this use case."}),"\n",(0,r.jsxs)(n.h4,{id:"using-hosts-file-for-dns-settings",children:["Using ",(0,r.jsx)(n.code,{children:"hosts"})," file for DNS Settings"]}),"\n",(0,r.jsx)(n.p,{children:"The hosts file contains the Internet Protocol (IP) host names and addresses for the local host and other hosts in the network. This file is used to resolve a name into an address (that is, to translate a host name into its IP)."}),"\n",(0,r.jsx)(n.p,{children:"So, you can use hosts file like DNS by adding all required subdomains with their mapped IP address."}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"Hosts file is located at:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/etc/hosts"})," on Linux and MacOS"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"C:\\Windows\\System32\\drivers\\etc\\hosts"})," on Windows"]}),"\n"]})]}),"\n",(0,r.jsx)(n.p,{children:"Entries in the hosts file have the following format:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"Address  HostName\n"})}),"\n",(0,r.jsxs)(n.p,{children:["On self-hosted Appcircle server, you should add below entries to the ",(0,r.jsx)(n.code,{children:"/etc/hosts"})," file."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"0.0.0.0  api.appcircle.spacetech.com\n0.0.0.0  auth.appcircle.spacetech.com\n0.0.0.0  dist.appcircle.spacetech.com\n0.0.0.0  hook.appcircle.spacetech.com\n0.0.0.0  my.appcircle.spacetech.com\n0.0.0.0  resource.appcircle.spacetech.com\n0.0.0.0  store.appcircle.spacetech.com\n0.0.0.0  monitor.appcircle.spacetech.com\n0.0.0.0  store.spacetech.com\n"})}),"\n",(0,r.jsxs)(n.p,{children:["For clients that will connect to self-hosted Appcircle server, either self-hosted runners or end-users using their browsers for web UI, should add external IP of the server to their ",(0,r.jsx)(n.code,{children:"/etc/hosts"})," files. External IP is the address of self-hosted Appcircle server that other hosts in the network can reach to server using that address."]}),"\n",(0,r.jsx)(n.p,{children:"You can get external IP of self-hosted Appcircle server with below command."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"hostname -I | awk '{print $1}'\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Let's assume we got value ",(0,r.jsx)(n.code,{children:"35.241.181.2"})," as an example."]}),"\n",(0,r.jsxs)(n.p,{children:["Other clients that connect to the server should add below entries to their ",(0,r.jsx)(n.code,{children:"/etc/hosts"})," files."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"35.241.181.2  api.appcircle.spacetech.com\n35.241.181.2  auth.appcircle.spacetech.com\n35.241.181.2  dist.appcircle.spacetech.com\n35.241.181.2  hook.appcircle.spacetech.com\n35.241.181.2  my.appcircle.spacetech.com\n35.241.181.2  resource.appcircle.spacetech.com\n35.241.181.2  store.appcircle.spacetech.com\n35.241.181.2  monitor.appcircle.spacetech.com\n35.241.181.2  store.spacetech.com\n"})}),"\n",(0,r.jsx)(n.p,{children:"With this network setup, you can run and test both self-hosted Appcircle server and connected self-hosted runners with all functionality."}),"\n",(0,r.jsx)(n.h3,{id:"5-run-server",children:"5. Run Server"}),"\n",(0,r.jsxs)(n.p,{children:["Appcircle server's modules are run on Podman as a container application on your system. All containers are run using a ",(0,r.jsx)(n.code,{children:"compose.yaml"})," file which is generated after ",(0,r.jsx)(n.code,{children:"ac-self-hosted.sh"})," is executed successfully explained in above steps."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"projects/${YOUR_PROJECT}/export"})," path will have all exported environment for self-hosted Appcircle services along with ",(0,r.jsx)(n.code,{children:"compose.yaml"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"projects/\n\u2514\u2500\u2500 spacetech\n    \u251c\u2500\u2500 export\n    \u2502\xa0\xa0 \u251c\u2500\u2500 agent-cache\n    \u2502\xa0\xa0 \u251c\u2500\u2500 api-gateway\n    \u2502\xa0\xa0 \u251c\u2500\u2500 build\n    \u2502\xa0\xa0 \u251c\u2500\u2500 common.env\n    \u2502\xa0\xa0 \u251c\u2500\u2500 compose.yaml\n    \u2502\xa0\xa0 \u251c\u2500\u2500 distribution\n    \u2502\xa0\xa0 \u251c\u2500\u2500 keycloak\n    \u2502\xa0\xa0 \u251c\u2500\u2500 keycloak-migration\n    \u2502\xa0\xa0 \u251c\u2500\u2500 license\n    \u2502\xa0\xa0 \u251c\u2500\u2500 minio\n    \u2502\xa0\xa0 \u251c\u2500\u2500 mongo\n    \u2502\xa0\xa0 \u251c\u2500\u2500 nginx\n    \u2502\xa0\xa0 \u251c\u2500\u2500 notification\n    \u2502\xa0\xa0 \u251c\u2500\u2500 postgres\n    \u2502\xa0\xa0 \u251c\u2500\u2500 report\n    \u2502\xa0\xa0 \u251c\u2500\u2500 rijndael\n    \u2502\xa0\xa0 \u251c\u2500\u2500 signing-identity\n    \u2502\xa0\xa0 \u251c\u2500\u2500 store\n    \u2502\xa0\xa0 \u251c\u2500\u2500 store-submit\n    \u2502\xa0\xa0 \u251c\u2500\u2500 tester-web\n    \u2502\xa0\xa0 \u251c\u2500\u2500 vault\n    \u2502\xa0\xa0 \u251c\u2500\u2500 webApp\n    \u2502\xa0\xa0 \u2514\u2500\u2500 webhook\n    \u251c\u2500\u2500 generated-secret.yaml\n    \u251c\u2500\u2500 global.yaml\n    \u2514\u2500\u2500 user-secret\n"})}),"\n",(0,r.jsx)(n.p,{children:"Run Appcircle server services."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" up\n'})}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.h4,{id:"artifact-registry-credentials-credjson",children:"Artifact Registry Credentials: Cred.json"}),(0,r.jsx)(n.p,{children:"Before we run self-hosted appcircle, we need to set artifact registry credentials. Using credentials JSON key file, we will pull container images for Appcircle server services."}),(0,r.jsx)(n.p,{children:"Although it's not required immediately at configuration steps, it's required while we're starting Appcircle server. Otherwise it can not pull container images from our artifact registry."}),(0,r.jsxs)(n.p,{children:["For this reason, it's a part of the configuration. ",(0,r.jsx)(n.code,{children:"ac-self-hosted.sh"})," bash script configures podman with appropriate credentials. If you don't have the key file, bash script gives error with a detailed message about the requirement."]}),(0,r.jsx)(n.p,{children:"When you buy an enterprise license for self-hosted appcircle, you will get a credentials JSON key file which enables you to login our artifact registry. For example, assume our fictive company is Space Tech."}),(0,r.jsxs)(n.p,{children:["You've got ",(0,r.jsx)(n.code,{children:"space-tech-cred.json"})," key file and downloaded it into ",(0,r.jsx)(n.code,{children:"~/Downloads"})," folder."]}),(0,r.jsx)(n.p,{children:"First you need to copy that key file into self-hosted Appcircle root directory."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cp ~/Downloads/space-tech-cred.json cred.json\n"})}),(0,r.jsx)(n.p,{children:"After that you can execute below command."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" up\n'})}),(0,r.jsx)(n.p,{children:"You should see"}),(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:'"Podman login cred not found. Trying to login now..."'}),"\n"]}),(0,r.jsx)(n.p,{children:"in command output and then"}),(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:'"Login Succeeded"'}),"\n"]}),(0,r.jsx)(n.p,{children:"which shows us successful artifact registry login."}),(0,r.jsxs)(n.p,{children:["If you get any error for some reason at this step, you can remove ",(0,r.jsx)(n.code,{children:"${XDG_RUNTIME_DIR}/containers/auth.json"})," file to reset and execute same command again to retake same steps."]})]}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"At first run, it will pull once all container images needed from artifact registry. Also there are some migration steps taken for once which prepares system for other operations."}),(0,r.jsx)(n.p,{children:"So it may need up to ~20 min to system be up according to your internet connection speed and CPU power. But recurrent boots will take a couple of minutes and will have shorter durations."})]}),"\n",(0,r.jsx)(n.p,{children:"Now you can check system health and gain an overview of the status."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" check\n'})}),"\n",(0,r.jsx)(n.p,{children:"It will give a quick health summary. You should see below message on success."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:" All services are running successfully. Project name is spacetech\n"})}),"\n",(0,r.jsx)(n.p,{children:"If you want to get details about podman services, you may run the following commands."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd projects/spacetech/export\npodman-compose ps\n"})}),"\n",(0,r.jsx)(n.p,{children:'If everything is okay, then you should see service statuses as "up", "up (healthy)" or "exited (0)".'}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.h4,{id:"vault",children:"Vault"}),(0,r.jsx)(n.p,{children:"All secret data, including the API keys, signing identities, environment variables, and secrets are stored in an HashiCorp Vault. OAuth tokens and SSH keys, used in build pipeline, are also stored securely in HashiCorp Vault."}),(0,r.jsxs)(n.p,{children:["Vault is a tool for securely accessing secrets. It's an important and required service for whole self-hosted Appcircle server. If it's status is ",(0,r.jsx)(n.code,{children:"unhealthy"}),", secrets will be inaccessible and most CI/CD functions won't work properly."]}),(0,r.jsxs)(n.p,{children:["For this reason, ",(0,r.jsx)(n.strong,{children:"before starting to use self-hosted Appcircle server"})," within your organization, make sure you check ",(0,r.jsx)(n.strong,{children:"vault service"})," status in container list above. Its ",(0,r.jsxs)(n.strong,{children:["status must be ",(0,r.jsx)(n.code,{children:"healthy"})]}),"."]}),(0,r.jsxs)(n.p,{children:["While you're working on configuration back and forth, it's status may become ",(0,r.jsx)(n.code,{children:"unhealthy"})," in some way."]}),(0,r.jsx)(n.p,{children:"In this case, stop all services with data cleanup."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" reset\n'})}),(0,r.jsxs)(n.p,{children:["Then make a new export and start services. Refer to ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/install-server/podman#reset-configuration",children:"reset configuration"})," section for more details."]})]}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"Self-hosted Appcircle server uses some ports for communication."}),(0,r.jsx)(n.p,{children:"Below ports must be unused on system and dedicated to only Appcircle server usage."}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"80"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"443"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"8080"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"8443"})}),"\n"]}),(0,r.jsxs)(n.p,{children:["Appcircle server will listen on ",(0,r.jsx)(n.code,{children:"8080"})," and ",(0,r.jsx)(n.code,{children:"8443"})," ports by default for HTTP and HTTPS connections.\nYou can get a list of up-to-date ports used by podman with below command."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo netstat -tulpn | grep LISTEN | grep -E 'rootlessport|socat'\n"})}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Filter "rootlessport" to see ports used by podman.'}),"\n",(0,r.jsx)(n.li,{children:'Filter "socat" to see ports used by port forwarder tool socket.'}),"\n"]})]}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.h5,{id:"rebooting-the-server",children:"Rebooting the Server"}),(0,r.jsx)(n.p,{children:"By default, the Appcircle server containers do not start automatically upon rebooting the host when podman is used as the container engine."}),(0,r.jsx)(n.p,{children:"To enable automatic startup of the Appcircle server containers, additional steps are required."}),(0,r.jsxs)(n.p,{children:["For detailed instructions on configuring the automatic startup of the server containers upon server reboot, please refer to the ",(0,r.jsx)(n.a,{href:"../configure-server/restarting-host",children:"Restarting Host"})," page."]})]}),"\n",(0,r.jsx)(n.h4,{id:"using-3rd-party-or-self-hosted-artifact-registry",children:"Using 3rd Party or Self-hosted Artifact Registry"}),"\n",(0,r.jsxs)(n.p,{children:["If your organization uses another registry (harbor, nexus, etc.), in order to use the Appcircle registry, you can head to the ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/configure-server/external-image-registry",children:"External Image Registries"})," document for detailed usage and configuration examples."]}),"\n",(0,r.jsxs)(n.h3,{id:"tada-ready",children:["\ud83c\udf89"," Ready"]}),"\n",(0,r.jsxs)(n.p,{children:["Open your browser and go to URL ",(0,r.jsx)(n.code,{children:"http://my.appcircle.spacetech.com"}),". You should see login page."]}),"\n",(0,r.jsx)(o.A,{url:"https://cdn.appcircle.io/docs/assets/self-hosted-appcircle-login-page.png"}),"\n",(0,r.jsxs)(n.p,{children:["Login to self-hosted Appcircle with ",(0,r.jsx)(n.code,{children:"initialUsername"})," and ",(0,r.jsx)(n.code,{children:"initialPassword"})," that we have configured in above steps. For our example, user name is ",(0,r.jsx)(n.code,{children:"admin@spacetech.com"}),"."]}),"\n",(0,r.jsx)(o.A,{url:"https://cdn.appcircle.io/docs/assets/self-hosted-appcircle-dashboard-page.png"}),"\n",(0,r.jsxs)(n.p,{children:["You can also login to enterprise app store with configured custom URL ",(0,r.jsx)(n.code,{children:"store.spacetech.com"}),"."]}),"\n",(0,r.jsx)(o.A,{url:"https://cdn.appcircle.io/docs/assets/self-hosted-appcircle-enterprise-app-store.png"}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"Although you can run export multiple times with different project names, you can run only one of them as an Appcircle server instance."}),(0,r.jsxs)(n.p,{children:["With default installation steps, reserved ports are the same for all exports. For this reason, when you run ",(0,r.jsx)(n.code,{children:"./ac-self-hosted.sh -n spacetech up"})," first instance will reserve open ports to itself. And later ",(0,r.jsx)(n.code,{children:"./ac-self-hosted.sh -n spacetech up"}),' commands for other projects will get errors like "port is already allocated".']})]}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"For now, self-hosted Appcircle server is a single node solution. You can not scale it by adding more nodes with other bare-metals or VMs."}),(0,r.jsx)(n.p,{children:"Because it has a self-contained architecture with all its data side-by-side its podman services. Every node can only use its internal volumes and data on host."})]}),"\n",(0,r.jsx)(n.h2,{id:"reset-configuration",children:"Reset Configuration"}),"\n",(0,r.jsx)(n.p,{children:"If you have made a mistake at installation steps, especially at configuration, you can reconfigure your server after installation."}),"\n",(0,r.jsx)(n.p,{children:"All configuration updates requires Appcircle server restart. So resetting configuration should start with stopping Appcircle server."}),"\n",(0,r.jsx)(n.p,{children:"Stop Appcircle server services."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" down\n'})}),"\n",(0,r.jsx)(n.p,{children:"On complete, you can check list of running services with command below."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" check\n'})}),"\n",(0,r.jsx)(n.p,{children:"Its response should be something like below."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"WARNING:Services are not started. Project name is spacetech"})}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.p,{children:"Some configuration changes may require data cleanup with extra steps which means data loss if you use Appcircle server for some time."}),(0,r.jsxs)(n.p,{children:["For example, you can add other git providers with above steps any time you want without any data loss. But changing ",(0,r.jsx)(n.code,{children:"external.scheme"}),' from "http" to "https" or changing ',(0,r.jsx)(n.code,{children:"smtpServer.*"})," settings requires podman volume prune which results with data cleanup."]}),(0,r.jsx)(n.p,{children:"So, we suggest you to be sure with your configuration before using it in production environment. You can try different settings back and forth until you're satisfied."}),(0,r.jsx)(n.p,{children:"To begin reconfiguration with data cleanup, use below command while stopping Appcircle server."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" reset\n'})}),(0,r.jsx)(n.p,{children:"It will remove all unused local volumes which is useful for a clean start."})]}),"\n",(0,r.jsxs)(n.p,{children:["Then go back to your configuration and change settings as done previously at ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/install-server/podman#3-configure",children:"configure"})," step."]}),"\n",(0,r.jsx)(n.p,{children:"When you're ready for a new export, in root directory execute below command again as done previously."}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["For our example scenario, root directory is ",(0,r.jsx)(n.code,{children:"appcircle-server"})," as seen ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/install-server/podman#1-download",children:"here"}),'. And project name is "spacetech".']})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./ac-self-hosted.sh -n "spacetech" export\n'})}),"\n",(0,r.jsx)(n.p,{children:"Now you are ready to restart self-hosted appcircle."}),"\n",(0,r.jsx)(n.p,{children:"Run Appcircle server services."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'/ac-self-hosted.sh -n "spacetech" up\n'})}),"\n",(0,r.jsx)(n.h2,{id:"connecting-runners",children:"Connecting Runners"}),"\n",(0,r.jsxs)(n.p,{children:["When you complete installation successfully by following above steps, you're ready for your first build. ","\ud83c\udf89"]}),"\n",(0,r.jsx)(n.p,{children:"But in order to run build pipelines, you need to install and connect self-hosted runners. We have dedicated section for installation and configuration of self-hosted runners."}),"\n",(0,r.jsxs)(n.p,{children:["Follow and apply related guidelines in ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/self-hosted-runner/installation",children:"here"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Self-hosted runner section in docs, has all details about runners and their configuration."}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsxs)(n.p,{children:["By default, self-hosted runner package has pre-configured ",(0,r.jsx)(n.code,{children:"ASPNETCORE_BASE_API_URL"})," for Appcircle-hosted cloud."]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"https://api.appcircle.io/build/v1"})}),"\n"]}),(0,r.jsxs)(n.p,{children:["\u261d"," You need to change its value with your self-hosted Appcircle server's API URL."]}),(0,r.jsx)(n.p,{children:"Assuming our sample scenario explained above, its value should be"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"http://api.appcircle.spacetech.com/build/v1"})}),"\n"]}),(0,r.jsx)(n.p,{children:"for our example configuration."}),(0,r.jsxs)(n.p,{children:["\ud83c\udf97"," After ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/self-hosted-runner/installation#1-download",children:"download"}),", open ",(0,r.jsx)(n.code,{children:"appsettings.json"})," with a text editor and change ",(0,r.jsx)(n.code,{children:"ASPNETCORE_BASE_API_URL"})," value according to your configuration."]}),(0,r.jsxs)(n.p,{children:["Please note that, you should do this before ",(0,r.jsx)(n.a,{href:"/self-hosted-appcircle/self-hosted-runner/installation#2-register",children:"register"}),"."]})]}),"\n",(0,r.jsx)(n.p,{children:"Considering system performance, it will be good to install self-hosted runners to other machines. Self-hosted Appcircle server should run on a dedicated machine itself."}),"\n",(0,r.jsx)(n.p,{children:"You can install any number of runners regarding to your needs and connect them to self-hosted Appcircle server."})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},69678:(e,n,s)=>{s.d(n,{A:()=>i});s(96540);var r=s(74848);function i(e){let{url:n}=e;return(0,r.jsx)("img",{className:"screenshot",src:n})}},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var r=s(96540);const i={},o=r.createContext(i);function t(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);