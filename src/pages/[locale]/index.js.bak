import React, { useEffect } from 'react';
import Head from 'next/head';
import Image from 'next/image';
import SelectFileToUpload from '../../components/SelectFileToUpload';
import { Box, Button, IconButton, Menu, MenuItem, Stack, Typography } from '@mui/material';
import TranslateIcon from '@mui/icons-material/Translate';
import DeleteIcon from '@mui/icons-material/Delete';
import { useRouter } from 'next/router';

import { useTranslation } from 'next-i18next';
import { getStaticPaths, makeStaticProps } from '../../lib/getStatic';

import { Header } from '../../components/Header';
import { Footer } from '../../components/Footer';

// handled lang options link
import Link from '../../components/Link';

const Homepage = () => {
  const router = useRouter();
  const { t } = useTranslation(['common', 'footer']);
  const [anchorEl, setAnchorEl] = React.useState(null);
  const open = Boolean(anchorEl);

  const handleClick = event => {
    setAnchorEl(event.currentTarget);
  };
  const handleClose = () => {
    setAnchorEl(null);
  };

  const changeToEnglish = () => {
    localStorage.setItem('i18nextLng', 'en');
    handleClose();
    router.reload();
  };

  const changeToZhHk = () => {
    localStorage.setItem('i18nextLng', 'zh_hk');
    handleClose();
    router.reload();
  };

  return (
    <>
      <Head>
        <title>Upload - louislabs.com</title>
        <meta name="description" content="file upload service for louislabs.com" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Box height={'10vh'}>
        <Stack direction={'row'} justifyContent={'flex-end'} paddingTop={'1rem'} paddingRight={'1rem'}>
          <IconButton aria-label="delete" onClick={handleClick}>
            <TranslateIcon />
          </IconButton>
          <Menu
            id="basic-menu"
            anchorEl={anchorEl}
            open={open}
            onClose={handleClose}
            MenuListProps={{
              'aria-labelledby': 'basic-button',
            }}
          >
            <MenuItem onClick={changeToEnglish}>{t('english')}</MenuItem>
            <MenuItem onClick={changeToZhHk}>{t('zh_hk')}</MenuItem>
          </Menu>
        </Stack>
      </Box>
      <Stack minHeight={'80vh'} direction={'column'} justifyContent={'center'} alignItems={'center'}>
        <SelectFileToUpload />
      </Stack>

      {t('h1')}
    </>
  );
};

export default Homepage;

const getStaticProps = makeStaticProps(['common', 'footer']);
export { getStaticPaths, getStaticProps };

export const getServerSideProps = setup(async ({ req, res }) => {
  console.log('setup csrf');
  return { props: {} };
});
